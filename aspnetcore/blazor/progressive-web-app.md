---
title: Creazione di applicazioni Web Blazor progressive con ASP.NET WebAssembly di base
author: guardrex
description: Informazioni su come Blazorcreare un'applicazione Web progressiva basata su PWA che utilizza le funzionalità del browser moderno per comportarsi come un'app desktop.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/23/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fe69e51aefae9c80e5bb4b78151d384ce25d41a7
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2020
ms.locfileid: "80218947"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="70521-103">Creazione di applicazioni Web progressive con ASP.NETCore Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="70521-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="70521-104">Di [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="70521-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="70521-105">Un'applicazione Web progressiva (PWA) è un'applicazione a pagina singola (SPA) che utilizza le moderne API del browser e le funzionalità per comportarsi come un'applicazione desktop.</span><span class="sxs-lookup"><span data-stu-id="70521-105">A Progressive Web Application (PWA) is a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="70521-106">Blazor WebAssembly è una piattaforma di app Web lato client basata su standard, pertanto può usare qualsiasi API del browser, incluse le API di PWA necessarie per le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="70521-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="70521-107">Lavorare offline e caricare istantaneamente, indipendentemente dalla velocità della rete.</span><span class="sxs-lookup"><span data-stu-id="70521-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="70521-108">In esecuzione nella propria finestra dell'app, non solo in una finestra del browser.</span><span class="sxs-lookup"><span data-stu-id="70521-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="70521-109">Avvio dal menu di avvio del sistema operativo, dal dock o dalla schermata iniziale dell'host.</span><span class="sxs-lookup"><span data-stu-id="70521-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="70521-110">Ricezione di notifiche push da un server back-end, anche se l'utente non usa l'app.</span><span class="sxs-lookup"><span data-stu-id="70521-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="70521-111">Aggiornamento automatico in background.</span><span class="sxs-lookup"><span data-stu-id="70521-111">Automatically updating in the background.</span></span>

<span data-ttu-id="70521-112">La parola *progressivo* viene utilizzata per descrivere tali app perché:</span><span class="sxs-lookup"><span data-stu-id="70521-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="70521-113">Un utente potrebbe prima scoprire e utilizzare l'applicazione all'interno del proprio browser web come qualsiasi altra SPA.</span><span class="sxs-lookup"><span data-stu-id="70521-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="70521-114">Successivamente, l'utente progredisce a installarlo nel proprio sistema operativo e l'abilitazione delle notifiche push.</span><span class="sxs-lookup"><span data-stu-id="70521-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="70521-115">Creare un progetto dal modello di Project Web Access</span><span class="sxs-lookup"><span data-stu-id="70521-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="70521-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="70521-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="70521-117">Quando si crea una nuova **applicazione Blazor WebAssembly** nella finestra di dialogo **Crea un nuovo progetto,** selezionare la casella di controllo **Stato di avanzamento applicazione Web:**</span><span class="sxs-lookup"><span data-stu-id="70521-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progress Web Application** check box:</span></span>

![La casella di controllo 'Applicazione Web progressiva' è selezionata nella finestra di dialogo Nuovo progetto di Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="70521-119">Visual Studio Code/Interfaccia della riga di comando di .NET Core</span><span class="sxs-lookup"><span data-stu-id="70521-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="70521-120">Creare un progetto di Project Web `--pwa` Access in una shell dei comandi con l'opzione:</span><span class="sxs-lookup"><span data-stu-id="70521-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="70521-121">Facoltativamente, PWA può essere configurato per un'app creata dal modello Hosted di ASP.NET core.</span><span class="sxs-lookup"><span data-stu-id="70521-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="70521-122">Lo scenario di Project Web Access è indipendente dal modello di hosting.</span><span class="sxs-lookup"><span data-stu-id="70521-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="70521-123">Manifesto dell'installazione e dell'app</span><span class="sxs-lookup"><span data-stu-id="70521-123">Installation and app manifest</span></span>

<span data-ttu-id="70521-124">Quando si visita un'app creata utilizzando il modello di Project Web Access, gli utenti hanno la possibilità di installare l'app nel menu di avvio del sistema operativo, nel dock o nella schermata iniziale.</span><span class="sxs-lookup"><span data-stu-id="70521-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="70521-125">Il modo in cui questa opzione viene presentata dipende dal browser dell'utente.</span><span class="sxs-lookup"><span data-stu-id="70521-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="70521-126">Quando si utilizzano browser desktop basati su Chromium, ad esempio Edge o Chrome, viene visualizzato un pulsante **Aggiungi** all'interno della barra degli URL.</span><span class="sxs-lookup"><span data-stu-id="70521-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="70521-127">Dopo che l'utente seleziona il pulsante **Aggiungi,** riceve una finestra di dialogo di conferma:After the user selects the Add button, they receive a confirmation dialog:</span><span class="sxs-lookup"><span data-stu-id="70521-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Il diaglog di conferma in Google Chrome presenta un pulsante Installa per l'utente per l'app 'MyBlazorPwa'.](progressive-web-app/_static/image2.png)

<span data-ttu-id="70521-129">Su iOS, i visitatori possono installare PWA utilizzando il pulsante **Condividi** di Safari e la relativa opzione **Aggiungi alla schermata Home.**</span><span class="sxs-lookup"><span data-stu-id="70521-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="70521-130">Su Chrome per Android, gli utenti devono selezionare il pulsante **Menu** nell'angolo in alto a destra, seguito da **Aggiungi alla schermata Home**.</span><span class="sxs-lookup"><span data-stu-id="70521-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="70521-131">Una volta installata, l'app viene visualizzata nella propria finestra senza una barra degli indirizzi:</span><span class="sxs-lookup"><span data-stu-id="70521-131">Once installed, the app appears in its own window without an address bar:</span></span>

![L'app "MyBlazorPwa" viene eseguita in Google Chrome senza una barra degli indirizzi.](progressive-web-app/_static/image3.png)

<span data-ttu-id="70521-133">Per personalizzare il titolo della finestra, la combinazione di colori, l'icona o altri dettagli, vedere il file *manifest.json* nella directory *wwwroot* del progetto.</span><span class="sxs-lookup"><span data-stu-id="70521-133">To customize the window's title, color scheme, icon, or other details, see the *manifest.json* file in the project's *wwwroot* directory.</span></span> <span data-ttu-id="70521-134">Lo schema di questo file è definito dagli standard Web.</span><span class="sxs-lookup"><span data-stu-id="70521-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="70521-135">Per ulteriori informazioni, vedere [Documenti Web MDN: Manifesto dell'app Web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="70521-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="70521-136">Supporto offline</span><span class="sxs-lookup"><span data-stu-id="70521-136">Offline support</span></span>

<span data-ttu-id="70521-137">Per impostazione predefinita, le app create utilizzando l'opzione del modello di Project Web Access dispongono del supporto per l'esecuzione offline.</span><span class="sxs-lookup"><span data-stu-id="70521-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="70521-138">Un utente deve prima visitare l'app mentre è online.</span><span class="sxs-lookup"><span data-stu-id="70521-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="70521-139">Il browser scarica e memorizza automaticamente nella cache tutte le risorse necessarie per operare offline.</span><span class="sxs-lookup"><span data-stu-id="70521-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="70521-140">Il supporto allo sviluppo interferirebbe con il consueto ciclo di sviluppo di apportare modifiche e testarle.</span><span class="sxs-lookup"><span data-stu-id="70521-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="70521-141">Pertanto, il supporto offline è abilitato solo per le app *pubblicate.*</span><span class="sxs-lookup"><span data-stu-id="70521-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="70521-142">Se si intende distribuire un Project Web Access abilitato per la modalità offline, sono presenti [diversi avvisi e avvertenze importanti.](#caveats-for-offline-pwas)</span><span class="sxs-lookup"><span data-stu-id="70521-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="70521-143">Questi scenari sono intrinseci ai PWA offline e non specifici di Blazor.</span><span class="sxs-lookup"><span data-stu-id="70521-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="70521-144">Assicurati di leggere e comprendere queste avvertenze prima di formulare ipotesi sul funzionamento dell'app abilitata per la modalità offline.</span><span class="sxs-lookup"><span data-stu-id="70521-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="70521-145">Per vedere come funziona il supporto offline:</span><span class="sxs-lookup"><span data-stu-id="70521-145">To see how offline support works:</span></span>

1. <span data-ttu-id="70521-146">Pubblicare l'app.</span><span class="sxs-lookup"><span data-stu-id="70521-146">Publish the app.</span></span> <span data-ttu-id="70521-147">Per altre informazioni, vedere <xref:host-and-deploy/blazor/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="70521-147">For more information, see <xref:host-and-deploy/blazor/index#publish-the-app>.</span></span>
1. <span data-ttu-id="70521-148">Distribuire l'app in un server che supporta HTTPS e accedere all'app in un browser al relativo indirizzo HTTPS sicuro.</span><span class="sxs-lookup"><span data-stu-id="70521-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="70521-149">Aprire gli strumenti di sviluppo del browser e verificare che un *Service Worker* sia registrato per l'host nella scheda **Applicazione:**</span><span class="sxs-lookup"><span data-stu-id="70521-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![La scheda "Applicazione" degli strumenti di sviluppo di Google Chrome mostra un Service Worker attivato e in esecuzione.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="70521-151">Ricaricare la pagina ed esaminare la scheda **Rete.** Service **Worker** o **cache di memoria** sono elencati come origini per tutte le risorse della pagina:</span><span class="sxs-lookup"><span data-stu-id="70521-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Scheda "Rete" degli strumenti di sviluppo di Google Chrome che mostra le fonti per tutte le risorse della pagina.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="70521-153">Per verificare che il browser non dipenda dall'accesso di rete per caricare l'app:</span><span class="sxs-lookup"><span data-stu-id="70521-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="70521-154">Arrestare il server Web e vedere come l'applicazione continua a funzionare normalmente, che include i ricaricamento della pagina.</span><span class="sxs-lookup"><span data-stu-id="70521-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="70521-155">Allo stesso modo, l'applicazione continua a funzionare normalmente quando c'è una connessione di rete lenta.</span><span class="sxs-lookup"><span data-stu-id="70521-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="70521-156">Indicare al browser di simulare la modalità offline nella scheda **Rete:**</span><span class="sxs-lookup"><span data-stu-id="70521-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Scheda "Rete" degli strumenti di sviluppo di Google Chrome con il menu a discesa della modalità browser modificata da "Online" a "Offline".](progressive-web-app/_static/image6.png)

<span data-ttu-id="70521-158">Il supporto offline tramite un service worker Blazorè uno standard Web, non specifico di .</span><span class="sxs-lookup"><span data-stu-id="70521-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="70521-159">Per altre informazioni sugli operatori del servizio, vedere [Documenti Web MDN: API Service Worker](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="70521-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="70521-160">Per ulteriori informazioni sui modelli di utilizzo comuni per i service worker, consultate [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="70521-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

Blazor<span data-ttu-id="70521-161">Il modello pWA produce due file di lavoro del servizio:</span><span class="sxs-lookup"><span data-stu-id="70521-161">'s PWA template produces two service worker files:</span></span>

* <span data-ttu-id="70521-162">*wwwroot/service-worker.js*, utilizzato durante lo sviluppo.</span><span class="sxs-lookup"><span data-stu-id="70521-162">*wwwroot/service-worker.js*, which is used during development.</span></span>
* <span data-ttu-id="70521-163">*wwwroot/service-worker.published.js*, utilizzato dopo la pubblicazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="70521-163">*wwwroot/service-worker.published.js*, which is used after the app is published.</span></span>

<span data-ttu-id="70521-164">Per condividere la logica tra i due file di lavoro del servizio, considerare l'approccio seguente:To share logic between the two service worker files, consider the following approach:</span><span class="sxs-lookup"><span data-stu-id="70521-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="70521-165">Aggiungere un terzo file JavaScript per contenere la logica comune.</span><span class="sxs-lookup"><span data-stu-id="70521-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="70521-166">Usare [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) per caricare la logica comune in entrambi i file di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="70521-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="70521-167">Strategia di recupero con prima cache</span><span class="sxs-lookup"><span data-stu-id="70521-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="70521-168">Il *service-worker.published.js* incorporato risolve le richieste usando una strategia *cache-first.*</span><span class="sxs-lookup"><span data-stu-id="70521-168">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="70521-169">Ciò significa che il service worker preferisce restituire il contenuto memorizzato nella cache, indipendentemente dal fatto che l'utente disponga dell'accesso alla rete o che il contenuto più recente sia disponibile nel server.</span><span class="sxs-lookup"><span data-stu-id="70521-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="70521-170">La strategia cache-first è utile perché:</span><span class="sxs-lookup"><span data-stu-id="70521-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="70521-171">**Garantisce affidabilità.**</span><span class="sxs-lookup"><span data-stu-id="70521-171">**It ensures reliability.**</span></span> <span data-ttu-id="70521-172">&ndash;L'accesso alla rete non è uno stato booleano.</span><span class="sxs-lookup"><span data-stu-id="70521-172">&ndash; Network access isn't a boolean state.</span></span> <span data-ttu-id="70521-173">Un utente non è semplicemente online o offline:</span><span class="sxs-lookup"><span data-stu-id="70521-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="70521-174">Il dispositivo dell'utente può presupporre che sia online, ma la rete potrebbe essere così lenta da essere poco pratica da attendere.</span><span class="sxs-lookup"><span data-stu-id="70521-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="70521-175">La rete potrebbe restituire risultati non validi per determinati URL, ad esempio quando è presente un portale WIFI captive che attualmente blocca o reindirizza determinate richieste.</span><span class="sxs-lookup"><span data-stu-id="70521-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="70521-176">Questo è il motivo per cui l'API del `navigator.onLine` browser non è affidabile e non dovrebbe dipendere.</span><span class="sxs-lookup"><span data-stu-id="70521-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="70521-177">**Garantisce la correttezza.**</span><span class="sxs-lookup"><span data-stu-id="70521-177">**It ensures correctness.**</span></span> <span data-ttu-id="70521-178">&ndash;Quando si crea una cache di risorse offline, il service worker usa l'hashing del contenuto per garantire che abbia recuperato uno snapshot completo e autocoerente delle risorse in un singolo istante nel tempo.</span><span class="sxs-lookup"><span data-stu-id="70521-178">&ndash; When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="70521-179">Questa cache viene quindi utilizzata come unità atomica.</span><span class="sxs-lookup"><span data-stu-id="70521-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="70521-180">Non ha senso chiedere alla rete risorse più recenti, poiché le uniche versioni richieste sono quelle già memorizzate nella cache.</span><span class="sxs-lookup"><span data-stu-id="70521-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="70521-181">Qualsiasi altra cosa rischia l'incoerenza e l'incompatibilità (ad esempio, il tentativo di utilizzare versioni di assembly .NET che non sono stati compilati insieme).</span><span class="sxs-lookup"><span data-stu-id="70521-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="70521-182">Aggiornamenti in background</span><span class="sxs-lookup"><span data-stu-id="70521-182">Background updates</span></span>

<span data-ttu-id="70521-183">Come modello mentale, è possibile pensare a un PWA offline-first come comportarsi come un'app per dispositivi mobili che può essere installata.</span><span class="sxs-lookup"><span data-stu-id="70521-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="70521-184">L'app viene avviata immediatamente indipendentemente dalla connettività di rete, ma la logica dell'app installata proviene da uno snapshot temporizzato che potrebbe non essere la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="70521-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="70521-185">Il Blazor modello di Project Web Access produce app che tentano automaticamente di aggiornarsi in background ogni volta che l'utente visita e dispone di una connessione di rete funzionante.</span><span class="sxs-lookup"><span data-stu-id="70521-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="70521-186">Il modo in cui funziona è il seguente:</span><span class="sxs-lookup"><span data-stu-id="70521-186">The way this works is as follows:</span></span>

* <span data-ttu-id="70521-187">Durante la compilazione, il progetto genera un *manifesto degli asset*del service worker .</span><span class="sxs-lookup"><span data-stu-id="70521-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="70521-188">Per impostazione predefinita, questo è chiamato *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-188">By default, this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="70521-189">Il manifesto elenca tutte le risorse statiche necessarie per la funzione offline da parte dell'app, ad esempio assembly .NET, file JavaScript e CSS, inclusi gli iste del contenuto.</span><span class="sxs-lookup"><span data-stu-id="70521-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="70521-190">L'elenco delle risorse viene caricato dal service worker in modo che sappia quali risorse memorizzare nella cache.</span><span class="sxs-lookup"><span data-stu-id="70521-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="70521-191">Ogni volta che l'utente visita l'app, il browser richiede nuovamente *service-worker.js* e *service-worker-assets.js* in background.</span><span class="sxs-lookup"><span data-stu-id="70521-191">Each time the user visits the app, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="70521-192">I file vengono confrontati byte per byte con il service worker installato esistente.</span><span class="sxs-lookup"><span data-stu-id="70521-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="70521-193">Se il server restituisce il contenuto modificato per uno di questi file, il service worker tenta di installare una nuova versione di se stesso.</span><span class="sxs-lookup"><span data-stu-id="70521-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="70521-194">Quando si installa una nuova versione di se stessa, il service worker crea una nuova cache separata per le risorse offline e inizia a popolare la cache con le risorse elencate in *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="70521-195">Questa logica viene `onInstall` implementata nella funzione all'interno di *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-195">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="70521-196">Il processo viene completato correttamente quando tutte le risorse vengono caricate senza errori e tutti gli errori di contenuto corrispondono.</span><span class="sxs-lookup"><span data-stu-id="70521-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="70521-197">In caso di esito positivo, il nuovo service worker immette uno stato *di attesa per l'attivazione.*</span><span class="sxs-lookup"><span data-stu-id="70521-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="70521-198">Non appena l'utente chiude l'app (nessuna finestra o schede dell'app rimanente), il nuovo service worker diventa *attivo* e viene usato per le visite successive all'app.</span><span class="sxs-lookup"><span data-stu-id="70521-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="70521-199">Il vecchio service worker e la relativa cache vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="70521-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="70521-200">Se il processo non viene completato correttamente, la nuova istanza del lavoratore del servizio viene eliminata.</span><span class="sxs-lookup"><span data-stu-id="70521-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="70521-201">Il processo di aggiornamento viene tentato nuovamente alla successiva visita dell'utente, quando si spera che il client disponga di una connessione di rete migliore in grado di completare le richieste.</span><span class="sxs-lookup"><span data-stu-id="70521-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="70521-202">Personalizzare questo processo modificando la logica di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="70521-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="70521-203">Nessuno dei comportamenti precedenti è Blazor specifico, ma è semplicemente l'esperienza predefinita fornita dall'opzione del modello di Project Web Access.</span><span class="sxs-lookup"><span data-stu-id="70521-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="70521-204">Per altre informazioni, vedere [Documenti Web MDN: API Service Worker](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="70521-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="70521-205">Modalità di risoluzione delle richieste</span><span class="sxs-lookup"><span data-stu-id="70521-205">How requests are resolved</span></span>

<span data-ttu-id="70521-206">Come descritto nella sezione Strategia di [recupero di primo cache,](#cache-first-fetch-strategy) il service worker predefinito utilizza una strategia *cache-first,* vale a dire che tenta di gestire il contenuto memorizzato nella cache quando disponibile.</span><span class="sxs-lookup"><span data-stu-id="70521-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="70521-207">Se non è presente alcun contenuto memorizzato nella cache per un determinato URL, ad esempio quando si richiedono dati da un'API back-end, il service worker esegue il fallback a una normale richiesta di rete.</span><span class="sxs-lookup"><span data-stu-id="70521-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="70521-208">La richiesta di rete ha esito positivo se il server è raggiungibile.</span><span class="sxs-lookup"><span data-stu-id="70521-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="70521-209">Questa logica viene `onFetch` implementata all'interno della funzione all'interno *di service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-209">This logic is implemented inside `onFetch` function within *service-worker.published.js*.</span></span>

<span data-ttu-id="70521-210">Se i componenti Razor dell'app si basano sulla richiesta di dati dalle API back-end e vuoi fornire un'esperienza utente intuitiva per le richieste non riuscite a causa dell'indisponibilità della rete, implementa la logica all'interno dei componenti dell'app.</span><span class="sxs-lookup"><span data-stu-id="70521-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="70521-211">Ad esempio, `try/catch` `HttpClient` utilizzare intorno alle richieste.</span><span class="sxs-lookup"><span data-stu-id="70521-211">For example, use `try/catch` around `HttpClient` requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="70521-212">Supporto delle pagine con rendering del server</span><span class="sxs-lookup"><span data-stu-id="70521-212">Support server-rendered pages</span></span>

<span data-ttu-id="70521-213">Considera cosa accade quando l'utente passa `/counter` per la prima volta a un URL, ad esempio o qualsiasi altro collegamento diretto nell'app.</span><span class="sxs-lookup"><span data-stu-id="70521-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="70521-214">In questi casi, non si desidera restituire `/counter`il contenuto memorizzato nella cache `/index.html` come , Blazor ma è necessario che il browser carichi il contenuto memorizzato nella cache per avviare l'app WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="70521-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="70521-215">Queste richieste iniziali sono note come richieste di *navigazione,* a differenza di:These initial requests are known as navigation requests, at pposed to:</span><span class="sxs-lookup"><span data-stu-id="70521-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="70521-216">*richieste di risorse secondarie* per immagini, fogli di stile o altri file.</span><span class="sxs-lookup"><span data-stu-id="70521-216">*subresource* requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="70521-217">*recuperare/XHR* richieste per i dati API.</span><span class="sxs-lookup"><span data-stu-id="70521-217">*fetch/XHR* requests for API data.</span></span>

<span data-ttu-id="70521-218">Il service worker predefinito contiene la logica del caso speciale per le richieste di navigazione.</span><span class="sxs-lookup"><span data-stu-id="70521-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="70521-219">Il service worker risolve le richieste restituendo il contenuto memorizzato nella cache per `/index.html`, indipendentemente dall'URL richiesto.</span><span class="sxs-lookup"><span data-stu-id="70521-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="70521-220">Questa logica viene `onFetch` implementata nella funzione all'interno di *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-220">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="70521-221">Se l'app ha determinati URL che devono restituire codice `/index.html` HTML sottoposto a rendering del server e non essere serviti dalla cache, devi modificare la logica nel service worker.</span><span class="sxs-lookup"><span data-stu-id="70521-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="70521-222">Se tutti gli `/Identity/` URL contenenti devono essere gestiti come normali richieste solo online al server, modificare la logica *service-worker.published.js.* `onFetch`</span><span class="sxs-lookup"><span data-stu-id="70521-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="70521-223">Individuare il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="70521-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="70521-224">Modificare il codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="70521-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="70521-225">Se non si fa questa operazione, indipendentemente dalla connettività di rete, il service worker `/index.html`intercetta le richieste per tali URL e le risolve utilizzando .</span><span class="sxs-lookup"><span data-stu-id="70521-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="70521-226">Controllare la memorizzazione nella cache degli assetControl asset caching</span><span class="sxs-lookup"><span data-stu-id="70521-226">Control asset caching</span></span>

<span data-ttu-id="70521-227">Se il progetto `ServiceWorkerAssetsManifest` definisce la Blazorproprietà MSBuild, gli strumenti di compilazione generano un manifesto degli asset del service worker con il nome specificato.</span><span class="sxs-lookup"><span data-stu-id="70521-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="70521-228">Il modello di Project Web Access predefinito produce un file di progetto contenente la proprietà seguente:</span><span class="sxs-lookup"><span data-stu-id="70521-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="70521-229">Il file viene inserito nella directory di output *wwwroot,* `/service-worker-assets.js`in modo che il browser possa recuperarlo richiedendo .</span><span class="sxs-lookup"><span data-stu-id="70521-229">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="70521-230">Per visualizzare il contenuto di questo file, aprire */bin/Debug/'TARGET FRAMEWORK'/wwwroot/service-worker-assets.js* in un editor di testo.</span><span class="sxs-lookup"><span data-stu-id="70521-230">To see the contents of this file, open */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="70521-231">Tuttavia, non modificare il file, poiché viene rigenerato in ogni compilazione.</span><span class="sxs-lookup"><span data-stu-id="70521-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="70521-232">Per impostazione predefinita, questo manifesto elenca:By default, this manifest lists:</span><span class="sxs-lookup"><span data-stu-id="70521-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="70521-233">Tutte Blazorle risorse gestite, ad esempio gli assembly .NET e i file di runtime di WebAssembly .NET necessari per funzionare offline.</span><span class="sxs-lookup"><span data-stu-id="70521-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="70521-234">Tutte le risorse per la pubblicazione nella directory *wwwroot* dell'app, ad esempio immagini, fogli di stile e file JavaScript, incluse le risorse Web statiche fornite da progetti esterni e i pacchetti NuGet.</span><span class="sxs-lookup"><span data-stu-id="70521-234">All resources for publishing to the app's *wwwroot* directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="70521-235">È possibile controllare quali di queste risorse vengono recuperate e `onInstall` memorizzate nella cache dal service worker modificando la logica in *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="70521-236">Per impostazione predefinita, il service worker recupera e memorizza nella cache i file corrispondenti alle estensioni tipiche dei nomi di file Web, ad esempio *.html*, *.css*, *.js*e *.wasm*, oltre ai tipi di file specifici di Blazor WebAssembly (*.dll*, *.pdb*).</span><span class="sxs-lookup"><span data-stu-id="70521-236">By default, the service worker fetches and caches files matching typical web filename extensions such as *.html*, *.css*, *.js*, and *.wasm*, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="70521-237">Per includere risorse aggiuntive che non sono presenti nella directory wwwroot `ItemGroup` dell'app, definire voci MSBuild aggiuntive, come illustrato nell'esempio seguente:To include additional resources that aren's present in the app's *wwwroot* directory, define extra MSBuild entries, as shown in the following example:</span><span class="sxs-lookup"><span data-stu-id="70521-237">To include additional resources that aren't present in the app's *wwwroot* directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="70521-238">I `AssetUrl` metadati specificano l'URL relativo alla base che il browser deve utilizzare durante il recupero della risorsa da memorizzare nella cache.</span><span class="sxs-lookup"><span data-stu-id="70521-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="70521-239">Questo può essere indipendente dal nome del file di origine originale su disco.</span><span class="sxs-lookup"><span data-stu-id="70521-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="70521-240">L'aggiunta di a `ServiceWorkerAssetsManifestItem` non determina la pubblicazione del file nella directory *wwwroot* dell'app.</span><span class="sxs-lookup"><span data-stu-id="70521-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's *wwwroot* directory.</span></span> <span data-ttu-id="70521-241">L'output di pubblicazione deve essere controllato separatamente.</span><span class="sxs-lookup"><span data-stu-id="70521-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="70521-242">L'unico `ServiceWorkerAssetsManifestItem` fa sì che una voce aggiuntiva venga visualizzata nel manifesto delle risorse del service worker.</span><span class="sxs-lookup"><span data-stu-id="70521-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="70521-243">Notifiche push</span><span class="sxs-lookup"><span data-stu-id="70521-243">Push notifications</span></span>

<span data-ttu-id="70521-244">Come qualsiasi altro PWA, un Blazor WebAssembly PWA può ricevere notifiche push da un server back-end.</span><span class="sxs-lookup"><span data-stu-id="70521-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="70521-245">Il server può inviare notifiche push in qualsiasi momento, anche quando l'utente non utilizza attivamente l'app.</span><span class="sxs-lookup"><span data-stu-id="70521-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="70521-246">Ad esempio, le notifiche push possono essere inviate quando un altro utente esegue un'azione pertinente.</span><span class="sxs-lookup"><span data-stu-id="70521-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="70521-247">Il meccanismo per l'invio Blazor di una notifica push è completamente indipendente da WebAssembly, poiché viene implementato dal server back-end che può utilizzare qualsiasi tecnologia.</span><span class="sxs-lookup"><span data-stu-id="70521-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="70521-248">Se si desidera inviare notifiche push da un server ASP.NET Core, prendere in considerazione [l'utilizzo di una tecnica simile all'approccio adottato nel workshop Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="70521-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="70521-249">Il meccanismo per la ricezione e la visualizzazione Blazor di una notifica push sul client è indipendente anche da WebAssembly, poiché è implementato nel file JavaScript di service worker.</span><span class="sxs-lookup"><span data-stu-id="70521-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="70521-250">Per un esempio, vedere [l'approccio utilizzato nel workshop Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="70521-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="70521-251">Avvertenze per PWA offline</span><span class="sxs-lookup"><span data-stu-id="70521-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="70521-252">Non tutte le app devono tentare di supportare l'uso offline.</span><span class="sxs-lookup"><span data-stu-id="70521-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="70521-253">Il supporto offline aggiunge una complessità significativa, pur non essendo sempre rilevante per i casi d'uso richiesti.</span><span class="sxs-lookup"><span data-stu-id="70521-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="70521-254">Il supporto offline è in genere rilevante solo:</span><span class="sxs-lookup"><span data-stu-id="70521-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="70521-255">Se l'archivio dati primario è locale nel browser.</span><span class="sxs-lookup"><span data-stu-id="70521-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="70521-256">Ad esempio, l'approccio è rilevante in un'app con un'interfaccia utente per un dispositivo [IoT](https://en.wikipedia.org/wiki/Internet_of_things) che archivia i dati in `localStorage` o [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="70521-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="70521-257">Se l'app esegue una quantità significativa di lavoro per recuperare e memorizzare nella cache i dati dell'API back-end rilevanti per ogni utente in modo che possa spostarsi tra i dati offline.</span><span class="sxs-lookup"><span data-stu-id="70521-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="70521-258">Se l'app deve supportare la modifica, è necessario creare un sistema per tenere traccia delle modifiche e sincronizzare i dati con il back-end.</span><span class="sxs-lookup"><span data-stu-id="70521-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="70521-259">Se l'obiettivo è garantire che l'app venga caricata immediatamente indipendentemente dalle condizioni di rete.</span><span class="sxs-lookup"><span data-stu-id="70521-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="70521-260">Implementare un'esperienza utente adatta intorno alle richieste API back-end per mostrare lo stato di avanzamento delle richieste e comportarsi normalmente quando le richieste non riescono a causa di indisponibilità della rete.</span><span class="sxs-lookup"><span data-stu-id="70521-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="70521-261">Inoltre, i PWA offline devono affrontare una serie di complicazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="70521-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="70521-262">Gli sviluppatori devono acquisire familiarità con le avvertenze riportate nelle sezioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="70521-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="70521-263">Supporto offline solo quando viene pubblicato</span><span class="sxs-lookup"><span data-stu-id="70521-263">Offline support only when published</span></span>

<span data-ttu-id="70521-264">Durante lo sviluppo in genere si desidera vedere ogni modifica riflessa immediatamente nel browser senza passare attraverso un processo di aggiornamento in background.</span><span class="sxs-lookup"><span data-stu-id="70521-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="70521-265">Pertanto, Blazoril modello di Project Web Access di 's abilita il supporto offline solo quando viene pubblicato.</span><span class="sxs-lookup"><span data-stu-id="70521-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="70521-266">Quando si crea un'app offline, non è sufficiente testare l'app nell'ambiente di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="70521-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="70521-267">È necessario testare l'app nello stato pubblicato per comprendere come risponde alle diverse condizioni di rete.</span><span class="sxs-lookup"><span data-stu-id="70521-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="70521-268">Aggiornamento del completamento dopo la navigazione dell'utente dall'app</span><span class="sxs-lookup"><span data-stu-id="70521-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="70521-269">Gli aggiornamenti non vengono completati fino a quando l'utente non si è allontanato dall'app in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="70521-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="70521-270">Come spiegato nella sezione Aggiornamenti in [background,](#background-updates) dopo aver distribuito un aggiornamento all'app, il browser recupera i file di lavoro del servizio aggiornati per avviare il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="70521-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="70521-271">Ciò che sorprende molti sviluppatori è che, anche quando questo aggiornamento viene completato, **non** ha effetto fino a quando l'utente non è navigato in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="70521-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="70521-272">**Non** è sufficiente aggiornare la scheda che visualizza l'app, anche se è l'unica scheda che visualizza l'app.</span><span class="sxs-lookup"><span data-stu-id="70521-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="70521-273">Finché l'app non viene chiusa completamente, il nuovo service worker rimane in *attesa di attivare* lo stato.</span><span class="sxs-lookup"><span data-stu-id="70521-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="70521-274">**Questo non è Blazorspecifico di , ma piuttosto è un comportamento della piattaforma web standard.**</span><span class="sxs-lookup"><span data-stu-id="70521-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="70521-275">Ciò problematica in genere gli sviluppatori che stanno tentando di testare gli aggiornamenti al service worker o alle risorse memorizzate nella cache offline.</span><span class="sxs-lookup"><span data-stu-id="70521-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="70521-276">Se si archiviano gli strumenti di sviluppo del browser, è possibile che venga visualizzato un elemento simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="70521-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![La scheda "Applicazione" di Google Chrome mostra che l'assistente di servizio dell'app è "in attesa di attivazione".](progressive-web-app/_static/image7.png)

<span data-ttu-id="70521-278">Finché l'elenco dei "client", che sono schede o finestre che visualizzano l'app, non è vuoto, il lavoratore continua ad attendere.</span><span class="sxs-lookup"><span data-stu-id="70521-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="70521-279">Il motivo per cui i service worker fanno questo è per garantire la coerenza.</span><span class="sxs-lookup"><span data-stu-id="70521-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="70521-280">Coerenza significa che tutte le risorse vengono recuperate dalla stessa cache atomica.</span><span class="sxs-lookup"><span data-stu-id="70521-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="70521-281">Durante il test delle modifiche, potrebbe essere utile fare clic sul collegamento "skipWaiting" come mostrato nella schermata precedente, quindi ricaricare la pagina.</span><span class="sxs-lookup"><span data-stu-id="70521-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="70521-282">È possibile automatizzare questo per tutti gli utenti codificando il lavoratore del servizio per [saltare la fase di "attesa" e attivare immediatamente all'aggiornamento](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="70521-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="70521-283">Se si ignora la fase di attesa, si sta rinunciando alla garanzia che le risorse vengano sempre recuperate in modo coerente dalla stessa istanza della cache.</span><span class="sxs-lookup"><span data-stu-id="70521-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="70521-284">Gli utenti possono eseguire qualsiasi versione cronologica dell'app</span><span class="sxs-lookup"><span data-stu-id="70521-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="70521-285">Gli sviluppatori Web si aspettano abitualmente che gli utenti eseguano solo l'ultima versione distribuita dell'app Web, poiché è normale all'interno del modello di distribuzione Web tradizionale.</span><span class="sxs-lookup"><span data-stu-id="70521-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="70521-286">Tuttavia, un PWA offline-first è più simile a un'app per dispositivi mobili nativa, in cui gli utenti non eseguono necessariamente la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="70521-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="70521-287">Come spiegato nella sezione Aggiornamenti in [background,](#background-updates) dopo aver distribuito un aggiornamento all'app, **ogni utente esistente continua a usare una versione precedente per almeno un'ulteriore visita** perché l'aggiornamento si verifica in background e non viene attivato fino a quando l'utente non si sposta.</span><span class="sxs-lookup"><span data-stu-id="70521-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="70521-288">Inoltre, la versione precedente in uso non è necessariamente quella distribuita.</span><span class="sxs-lookup"><span data-stu-id="70521-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="70521-289">La versione precedente può essere *qualsiasi* versione cronologica, a seconda della data dell'ultimo completamento di un aggiornamento da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="70521-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="70521-290">Questo può essere un problema se le parti front-end e back-end dell'app richiedono un accordo sullo schema per le richieste API.</span><span class="sxs-lookup"><span data-stu-id="70521-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="70521-291">Non è necessario distribuire le modifiche dello schema dell'API non compatibili con le versioni precedenti fino a quando non si può essere certi che tutti gli utenti siano stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="70521-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="70521-292">In alternativa, impedisci agli utenti di usare versioni precedenti incompatibili dell'app.</span><span class="sxs-lookup"><span data-stu-id="70521-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="70521-293">Questo requisito di scenario è lo stesso delle app per dispositivi mobili native.</span><span class="sxs-lookup"><span data-stu-id="70521-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="70521-294">Se si distribuisce una modifica sostanziale nelle API del server, l'app client viene interrotta per gli utenti che non sono ancora stati aggiornati.</span><span class="sxs-lookup"><span data-stu-id="70521-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="70521-295">Se possibile, non distribuire le modifiche di rilievo alle API back-end.</span><span class="sxs-lookup"><span data-stu-id="70521-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="70521-296">In tal caso, è consigliabile usare [le API di Service Worker standard, ad esempio ServiceWorkerRegistration,](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) per determinare se l'app è aggiornata e, in caso contrario, per impedire l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="70521-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="70521-297">Interferenza con le pagine sottoposte a rendering del server</span><span class="sxs-lookup"><span data-stu-id="70521-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="70521-298">Come descritto nella sezione [Support server di cui è stato eseguito](#support-server-rendered-pages) il `/index.html` rendering, se si desidera ignorare il comportamento del service worker di restituzione del contenuto per tutte le richieste di navigazione, modificare la logica nel service worker.</span><span class="sxs-lookup"><span data-stu-id="70521-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="70521-299">Tutti i contenuti del manifesto dell'asset del service worker vengono memorizzati nella cache per impostazione predefinitaAll service worker asset manifest contents are cached by default</span><span class="sxs-lookup"><span data-stu-id="70521-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="70521-300">Come descritto nella sezione Controllare la [memorizzazione nella cache degli asset,](#control-asset-caching) il file *service-worker-assets.js* viene generato durante la compilazione ed elenca tutti gli asset che il service worker deve recuperare e memorizzare nella cache.</span><span class="sxs-lookup"><span data-stu-id="70521-300">As described in the [Control asset caching](#control-asset-caching) section, the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="70521-301">Poiché per impostazione predefinita questo elenco include tutto ciò che viene generato in *wwwroot*, inclusi i contenuti forniti da pacchetti e progetti esterni, è necessario fare attenzione a non inserire troppo contenuto.</span><span class="sxs-lookup"><span data-stu-id="70521-301">Since this list by default includes everything emitted to *wwwroot*, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="70521-302">Se la directory *wwwroot* contiene milioni di immagini, il service worker tenta di recuperarle e memorizzarle nella cache tutte, consumando una larghezza di banda eccessiva e molto probabilmente non viene completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="70521-302">If the *wwwroot* directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="70521-303">Implementare una logica arbitraria per controllare quale sottoinsieme del contenuto `onInstall` del manifesto deve essere recuperato e memorizzato nella cache modificando la funzione in *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="70521-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="70521-304">Interazione con l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="70521-304">Interaction with authentication</span></span>

<span data-ttu-id="70521-305">È possibile utilizzare l'opzione del modello di Project Web Access insieme alle opzioni di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="70521-305">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="70521-306">Un PWA offline può supportare anche l'autenticazione quando l'utente dispone di connettività di rete.</span><span class="sxs-lookup"><span data-stu-id="70521-306">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="70521-307">Quando un utente non dispone di connettività di rete, non può autenticare o ottenere token di accesso.</span><span class="sxs-lookup"><span data-stu-id="70521-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="70521-308">Per impostazione predefinita, il tentativo di visitare la pagina di accesso senza accesso alla rete genera un messaggio di "errore di rete".</span><span class="sxs-lookup"><span data-stu-id="70521-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span>

<span data-ttu-id="70521-309">È necessario progettare un flusso dell'interfaccia utente che consente all'utente di eseguire operazioni utili in modalità offline senza tentare di autenticare o ottenere i token di accesso.</span><span class="sxs-lookup"><span data-stu-id="70521-309">You must design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens.</span></span> <span data-ttu-id="70521-310">In alternativa, è possibile progettare l'applicazione in modo che non riesca in modo aggraziato quando la rete non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="70521-310">Alternatively, you can design the app to fail in a graceful way when the network isn't available.</span></span> <span data-ttu-id="70521-311">Se ciò non è possibile nell'app, è possibile che non si desideri abilitare il supporto offline.</span><span class="sxs-lookup"><span data-stu-id="70521-311">If this isn't possible in your app, you might not want to enable offline support.</span></span>
