---
title: Creazione di applicazioni Web progressive con ASP.NET Core Blazor webassembly
author: guardrex
description: Informazioni su come creare applicazioni Web progressive basate su Blazor(PWA), app Web che usano le funzionalità moderne del browser per comportarsi come le app desktop.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/09/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: f1c1ce50f20bf579e67e1d4eb02cc7d9d681e354
ms.sourcegitcommit: 98bcf5fe210931e3eb70f82fd675d8679b33f5d6
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/11/2020
ms.locfileid: "79083720"
---
# <a name="build-progressive-web-applications-with-aspnet-core-opno-locblazor-webassembly"></a><span data-ttu-id="6b1d2-103">Creazione di applicazioni Web progressive con ASP.NET Core Blazor webassembly</span><span class="sxs-lookup"><span data-stu-id="6b1d2-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="6b1d2-104">Di [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="6b1d2-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="6b1d2-105">Un'applicazione Web progressiva (PWA) è un'applicazione basata sul Web che usa le API e le funzionalità moderne del browser per comportarsi come un'applicazione desktop.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-105">A Progressive Web Application (PWA) is a web-based application that uses modern browser APIs and capabilities to behave like a desktop application.</span></span> <span data-ttu-id="6b1d2-106">Queste funzionalità possono includere:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-106">These capabilities can include:</span></span>

* <span data-ttu-id="6b1d2-107">Lavorare offline e caricare sempre immediatamente, indipendentemente dalla velocità di rete</span><span class="sxs-lookup"><span data-stu-id="6b1d2-107">Working offline and always loading instantly, independently of network speed</span></span>
* <span data-ttu-id="6b1d2-108">Possibilità di esecuzione nella finestra dell'applicazione, non solo in una finestra del browser</span><span class="sxs-lookup"><span data-stu-id="6b1d2-108">Being able to run in its own application window, not just a browser window</span></span>
* <span data-ttu-id="6b1d2-109">Viene avviato dal menu Start del sistema operativo host, ancorato o dalla schermata iniziale</span><span class="sxs-lookup"><span data-stu-id="6b1d2-109">Being launched from the host operating system (OS) start menu, dock, or home screen</span></span>
* <span data-ttu-id="6b1d2-110">Ricezione di notifiche push da un server back-end, anche quando l'utente non usa l'applicazione</span><span class="sxs-lookup"><span data-stu-id="6b1d2-110">Receiving push notifications from a backend server, even while the user is not using the application</span></span>
* <span data-ttu-id="6b1d2-111">Aggiornamento automatico in background</span><span class="sxs-lookup"><span data-stu-id="6b1d2-111">Automatically updating in the background</span></span>

<span data-ttu-id="6b1d2-112">Un utente potrebbe prima di tutto individuare e usare l'applicazione all'interno del Web browser come qualsiasi altra applicazione a singola pagina (SPA), quindi procedere in seguito per installarla nel sistema operativo e abilitare le notifiche push.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-112">A user might first discover and use the application within their web browser like any other single-page application (SPA), then later progress to installing it in their OS and enabling push notifications.</span></span> <span data-ttu-id="6b1d2-113">Ecco perché usiamo il termine *progressive*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-113">That's why we use the term *progressive*.</span></span>

Blazor<span data-ttu-id="6b1d2-114"> webassembly è una vera piattaforma applicativa lato client basata su standard, pertanto può usare qualsiasi API del browser, incluse le API di PWA necessarie per le funzionalità elencate in precedenza.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-114"> WebAssembly is a true standards-based client-side web application platform, so it can use any browser API, including PWA APIs needed for the capabilities listed above.</span></span> <span data-ttu-id="6b1d2-115">Può funzionare offline esattamente come qualsiasi altra tecnologia Web sul lato client.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-115">It can work offline just like any other client-side web technology.</span></span>

## <a name="pwa-template"></a><span data-ttu-id="6b1d2-116">Modello di PWA</span><span class="sxs-lookup"><span data-stu-id="6b1d2-116">PWA template</span></span>

<span data-ttu-id="6b1d2-117">Quando si crea una nuova applicazione Blazor webassembly, viene offerta la possibilità di aggiungere le funzionalità di PWA.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-117">When creating a new Blazor WebAssembly application, you are offered the option to add PWA features.</span></span> <span data-ttu-id="6b1d2-118">In Visual Studio, l'opzione viene specificata come casella di controllo nella finestra di dialogo di creazione del progetto:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-118">In Visual Studio, the option is given as a checkbox in the project creation dialog:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76207411-a6b54200-61f5-11ea-9dfc-6acd87a91428.png)

<span data-ttu-id="6b1d2-120">Se si sta creando il progetto nella riga di comando, è possibile usare il flag `--pwa`.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-120">If you're creating the project on the command line, you can use the `--pwa` flag.</span></span> <span data-ttu-id="6b1d2-121">Ad esempio,</span><span class="sxs-lookup"><span data-stu-id="6b1d2-121">For example,</span></span>

```dotnetcli
dotnet new blazorwasm --pwa -o MyNewProject
```

<span data-ttu-id="6b1d2-122">In entrambi i casi, è possibile combinare questa opzione con l'opzione "ASP.NET Core Hosted", se lo si desidera, ma non è necessario.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-122">In both cases, you're free to combine this with the "ASP.NET Core hosted" option if you wish, but don't have to do so.</span></span> <span data-ttu-id="6b1d2-123">Le funzionalità di PWA sono indipendenti dal modello di hosting.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-123">PWA features are independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="6b1d2-124">Installazione e manifesto dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="6b1d2-124">Installation and app manifest</span></span>

<span data-ttu-id="6b1d2-125">Quando si visita un'applicazione creata usando l'opzione del modello di PWA, gli utenti hanno la possibilità di installare l'applicazione nel menu Start del sistema operativo, nel Dock o nella schermata iniziale.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-125">When visiting an application created using the PWA template option, users have the option to install the application into their OS's start menu, dock, or home screen.</span></span>

<span data-ttu-id="6b1d2-126">Il modo in cui viene presentata questa opzione dipende dal browser dell'utente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-126">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="6b1d2-127">Ad esempio, quando si usano browser basati su Chrome Desktop come Edge o Chrome, viene visualizzato un pulsante *Aggiungi* nella barra degli URL:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-127">For example, when using desktop Chromium-based browsers such as Edge or Chrome, an *Add* button appears within the URL bar:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76208127-f7796a80-61f6-11ea-8aea-7fba704be787.png)

<span data-ttu-id="6b1d2-129">In iOS i visitatori possono installare il PWA usando il pulsante di *condivisione* di Safari e l'opzione *Aggiungi a homescreen* .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-129">On iOS, visitors can install the PWA using Safari's *Share* button and its *Add to Homescreen* option.</span></span> <span data-ttu-id="6b1d2-130">In Chrome per Android gli utenti devono toccare il pulsante di *menu* nell'angolo in alto a destra, quindi scegliere *Aggiungi alla schermata iniziale*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-130">On Chrome for Android, users should tap the *Menu* button in the upper-right corner, then choose *Add to Home screen*.</span></span>

<span data-ttu-id="6b1d2-131">Una volta installato, l'applicazione viene visualizzata nella propria finestra, senza alcuna barra degli indirizzi.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-131">Once installed, the application appears in its own window, without any address bar.</span></span>

![image](https://user-images.githubusercontent.com/1101362/76208588-e2e9a200-61f7-11ea-85e1-8c3fc849b252.png)

<span data-ttu-id="6b1d2-133">Per personalizzare il titolo della finestra, la combinazione di colori, l'icona o altri dettagli, vedere il file `manifest.json` nella directory *wwwroot* del progetto.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-133">To customize the window's title, color scheme, icon, or other details, see the file `manifest.json` in your project's *wwwroot* directory.</span></span> <span data-ttu-id="6b1d2-134">Lo schema di questo file è definito dagli standard Web.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="6b1d2-135">Per la documentazione dettagliata, vedere https://developer.mozilla.org/docs/Web/Manifest.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-135">For detailed documentation, see https://developer.mozilla.org/docs/Web/Manifest.</span></span>

## <a name="offline-support"></a><span data-ttu-id="6b1d2-136">Supporto offline</span><span class="sxs-lookup"><span data-stu-id="6b1d2-136">Offline support</span></span>

<span data-ttu-id="6b1d2-137">Per impostazione predefinita, le applicazioni create utilizzando l'opzione del modello PWA dispongono del supporto per l'esecuzione offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-137">By default, applications created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="6b1d2-138">Un utente deve prima visitare l'applicazione mentre è online, il browser scaricherà automaticamente e memorizza nella cache tutte le risorse necessarie per il funzionamento offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-138">A user must first visit the application while they are online, then the browser will automatically download and cache all the resources needed to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6b1d2-139">Il supporto offline è abilitato solo per le applicazioni *pubblicate* .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-139">Offline support is only enabled for *published* applications.</span></span> <span data-ttu-id="6b1d2-140">Non è abilitata durante lo sviluppo.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-140">It is not enabled during development.</span></span> <span data-ttu-id="6b1d2-141">Ciò è dovuto al fatto che interferisce con il normale ciclo di sviluppo di apportare modifiche e testarle.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-141">This is because it would interfere with the usual development cycle of making changes and testing them.</span></span>

> [!WARNING]
> <span data-ttu-id="6b1d2-142">Se si intende distribuire un PWA abilitato offline, è necessario comprendere [alcuni avvisi e Avvertenze importanti](#caveats-for-offline-pwas) .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-142">If you intend to ship an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas) you need to understand.</span></span> <span data-ttu-id="6b1d2-143">Sono intrinseci ai PWA offline e non sono specifici per Blazor.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-143">These are inherent to offline PWAs, and not specific to Blazor.</span></span> <span data-ttu-id="6b1d2-144">Assicurarsi di leggere e comprendere questi avvertimenti prima di ipotizzare il funzionamento dell'applicazione abilitata per offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled application will work.</span></span>

<span data-ttu-id="6b1d2-145">Per verificare il funzionamento del supporto offline, [pubblicare prima l'applicazione](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app)e ospitarla in un server che supporta HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-145">To see how offline support works, first [publish your application](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app), and host it on a server supporting HTTPS.</span></span> <span data-ttu-id="6b1d2-146">Quando si visita l'applicazione, dovrebbe essere possibile aprire gli strumenti di sviluppo del browser e verificare che un ruolo di *lavoro del servizio* sia registrato per l'host:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-146">When you visit the application, you should be able to open the browser's dev tools and verify that a *Service Worker* is registered for your host:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210294-bd5e9780-61fb-11ea-9869-65c55c62803d.png)

<span data-ttu-id="6b1d2-148">Inoltre, se si ricarica la pagina, nella scheda *rete* si noterà che tutte le risorse necessarie per caricare la pagina vengono recuperate dal ruolo di lavoro del *servizio* o dalla *cache della memoria*:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-148">Additionally, if you reload the page, then on the *Network* tab you should see that all resources needed to load your page are being retrieved from the *Service Worker* or *Memory Cache*:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210472-1d553e00-61fc-11ea-84c6-291644df709e.png)

<span data-ttu-id="6b1d2-150">Ciò indica che il browser non dipende dall'accesso alla rete per caricare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-150">This shows that the browser is not dependent on network access to load your application.</span></span> <span data-ttu-id="6b1d2-151">Per verificarlo, è possibile arrestare il server Web o indicare al browser di simulare la modalità offline:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-151">To verify this, you can either shut down your web server, or instruct the browser to simulate offline mode:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210556-47a6fb80-61fc-11ea-9d12-20a8f6528744.png)

<span data-ttu-id="6b1d2-153">A questo punto, anche senza accedere al server Web, dovrebbe essere possibile ricaricare la pagina e verificare che l'applicazione venga caricata ed eseguita.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-153">Now, even without access to your web server, you should be able to reload the page and see that your application still loads and runs.</span></span> <span data-ttu-id="6b1d2-154">Analogamente, anche se si simula una connessione di rete molto lenta, la pagina verrà caricata immediatamente perché viene caricata indipendentemente dalla rete.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-154">Likewise, even if you simulate a very slow network connection, your page will still load immediately since it is loaded independently of the network.</span></span>

### <a name="service-worker"></a><span data-ttu-id="6b1d2-155">Ruolo di lavoro del servizio</span><span class="sxs-lookup"><span data-stu-id="6b1d2-155">Service worker</span></span>

<span data-ttu-id="6b1d2-156">Il supporto offline viene eseguito tramite un ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-156">Offline support is achieved using a service worker.</span></span> <span data-ttu-id="6b1d2-157">Si tratta di uno standard Web, non specifico per Blazor.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-157">This is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="6b1d2-158">Per la documentazione relativa ai service worker, vedere https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-158">For documentation about service workers, see https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span></span> <span data-ttu-id="6b1d2-159">Per ulteriori informazioni sui modelli di utilizzo comuni per i ruoli di lavoro del servizio, vedere l'articolo eccellente ciclo di vita [del servizio](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-159">To learn more about common usage patterns for service workers, see the excellent article [The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="6b1d2-160">il modello PWA di Blazorproduce due file del ruolo di lavoro del servizio:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-160">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="6b1d2-161">*wwwroot/Service-Worker. js*, usato durante lo sviluppo</span><span class="sxs-lookup"><span data-stu-id="6b1d2-161">*wwwroot/service-worker.js*, which is used during development</span></span>
* <span data-ttu-id="6b1d2-162">*wwwroot/Service-Worker. Published. js*, che viene usato una volta pubblicata l'applicazione</span><span class="sxs-lookup"><span data-stu-id="6b1d2-162">*wwwroot/service-worker.published.js*, which is used once your application is published</span></span>

<span data-ttu-id="6b1d2-163">Se si vuole condividere la logica tra questi due file, è consigliabile aggiungere un terzo file JavaScript per includere la logica comune e usare [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) per caricare la logica in entrambi i file.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-163">If you want to share logic between these two files, consider adding a third JavaScript file to hold the common logic, and use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load that logic into both files.</span></span>

#### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="6b1d2-164">Strategia di recupero cache-First</span><span class="sxs-lookup"><span data-stu-id="6b1d2-164">Cache-first fetch strategy</span></span>

<span data-ttu-id="6b1d2-165">Il ruolo di lavoro del servizio *service-worker. Published. js* incorporato risolve le richieste usando una strategia di *cache-First* .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-165">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="6b1d2-166">Ciò significa che è sempre preferibile restituire il contenuto memorizzato nella cache, se disponibile, indipendentemente dal fatto che l'utente abbia accesso alla rete o che il contenuto più recente sia disponibile nel server.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-166">This means it always prefers to return cached content if available, regardless of whether the user has network access or whether newer content is available on the server.</span></span>

<span data-ttu-id="6b1d2-167">Questo è utile per due motivi:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-167">There are two reasons why this is valuable:</span></span>

* <span data-ttu-id="6b1d2-168">**Garantisce l'affidabilità.**</span><span class="sxs-lookup"><span data-stu-id="6b1d2-168">**It ensures reliability.**</span></span> <span data-ttu-id="6b1d2-169">L'accesso alla rete non è uno stato booleano.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-169">Network access is not a boolean state.</span></span> <span data-ttu-id="6b1d2-170">Un utente non è semplicemente "online" o "offline".</span><span class="sxs-lookup"><span data-stu-id="6b1d2-170">A user is not simply "online" or "offline".</span></span> <span data-ttu-id="6b1d2-171">In realtà, il dispositivo dell'utente può ritenere che sia online, ma la rete potrebbe essere così lenta da risultare poco pratica da attendere.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-171">In reality, the user's device may believe it is online, but the network may be so slow as to be impractical to wait for.</span></span> <span data-ttu-id="6b1d2-172">In alternativa, la rete potrebbe restituire risultati non validi per determinati URL, ad esempio quando è presente un portale Wi-Fi captive che sta attualmente bloccando o reindirizzando determinate richieste.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-172">Or the network might be returning invalid results for certain URLs, such as when there is a captive WIFI portal that is currently blocking or redirecting certain requests.</span></span> <span data-ttu-id="6b1d2-173">Questo è il motivo per cui l'API `navigator.onLine` del browser non è affidabile e non dipende da.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-173">This is why the browser's `navigator.onLine` API is not reliable and should not be depended upon.</span></span>
* <span data-ttu-id="6b1d2-174">**Garantisce la correttezza.**</span><span class="sxs-lookup"><span data-stu-id="6b1d2-174">**It ensures correctness.**</span></span> <span data-ttu-id="6b1d2-175">Quando si compila una cache di risorse offline, il ruolo di lavoro del servizio utilizza l'hashing del contenuto per garantire che sia stato recuperato uno snapshot completo e coerente delle risorse in un singolo momento.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-175">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="6b1d2-176">Questa cache viene quindi utilizzata come unità atomica.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-176">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="6b1d2-177">Dato questo, non ci sono punti che richiedono la rete per le risorse più recenti, perché le uniche versioni desiderate sono quelle già memorizzate nella cache.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-177">Given this, there is no point asking the network for newer resources, since the only versions you want are the ones you've already cached.</span></span> <span data-ttu-id="6b1d2-178">Altri rischiano incoerenza e incompatibilità (ad esempio, il tentativo di usare le versioni degli assembly .NET che non sono stati compilati insieme).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-178">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that were not compiled together).</span></span>

#### <a name="background-updates"></a><span data-ttu-id="6b1d2-179">Aggiornamenti in background</span><span class="sxs-lookup"><span data-stu-id="6b1d2-179">Background updates</span></span>

<span data-ttu-id="6b1d2-180">Come modello mentale, è possibile pensare a un'app per dispositivi mobili che può essere installata in modalità offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-180">As a mental model, you can think of an offline-first PWA as behaving like an mobile app that can be installed.</span></span> <span data-ttu-id="6b1d2-181">Viene sempre avviato immediatamente indipendentemente dalla connettività di rete, ma la logica dell'applicazione installata deriva da uno snapshot temporizzato che potrebbe non essere la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-181">It always starts up immediately regardless of network connectivity, but the installed application logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="6b1d2-182">Il modello di Blazor PWA produce applicazioni che tentano automaticamente di aggiornarsi in background ogni volta che l'utente visita e ha una connessione di rete funzionante.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-182">The Blazor PWA template produces applications that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="6b1d2-183">Il funzionamento di questo approccio è il seguente:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-183">The way this works is as follows:</span></span>

* <span data-ttu-id="6b1d2-184">Durante la compilazione, il progetto genera un manifesto delle risorse del ruolo di *lavoro del servizio*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-184">During compilation, your project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="6b1d2-185">Per impostazione predefinita, questo nome è denominato *service-worker-assets. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-185">By default this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="6b1d2-186">Vengono elencate tutte le risorse statiche di cui l'applicazione deve eseguire il funzionamento offline, ad esempio assembly .NET, file JavaScript, CSS e così via, inclusi gli hash del contenuto.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-186">This lists all the static resources your application needs to function offline, such as .NET assemblies, JavaScript files, CSS, etc., including their content hashes.</span></span> <span data-ttu-id="6b1d2-187">Questo elenco viene caricato dal ruolo di lavoro del servizio in modo da sapere quali risorse memorizzare nella cache.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-187">This list is loaded by your service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="6b1d2-188">Ogni volta che l'utente visita l'applicazione, il browser richiede nuovamente *service-worker. js* e *service-worker-assets. js* in background.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-188">Each time the user visits your application, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="6b1d2-189">Se il server restituisce il contenuto modificato per uno di questi file (a confronto byte per byte con il ruolo di lavoro del servizio installato esistente), il ruolo di lavoro del servizio tenterà di installare una nuova versione di se stessa.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-189">If the server returns changed content for either of these files (compared byte-for-byte with the existing installed service worker), the service worker tries to install a new version of itself.</span></span>
* <span data-ttu-id="6b1d2-190">Quando si installa una nuova versione di se stessa, il ruolo di lavoro del servizio crea una nuova cache separata per le risorse offline e inizia a popolarla con le risorse elencate in *service-worker-assets. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-190">When installing a new version of itself, the service worker creates a new, separate cache for offline resources, and starts populating it with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="6b1d2-191">Questa logica viene implementata nella funzione `onInstall` all'interno di *service-worker. Published. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-191">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="6b1d2-192">Se il processo viene completato correttamente (ad esempio, tutte le risorse vengono caricate senza errori e tutti gli hash del contenuto corrispondono), il nuovo thread di lavoro entra in uno stato "in attesa di attivazione".</span><span class="sxs-lookup"><span data-stu-id="6b1d2-192">If the process completes successfully (i.e., all the resources are loaded without error, and all content hashes match), then the new service worker enters a "waiting for activation" state.</span></span> <span data-ttu-id="6b1d2-193">Non appena l'utente chiude l'applicazione (ad esempio, non sono presenti schede o finestre rimanenti che visualizzano l'applicazione), il nuovo servizio di lavoro diventa "attivo" e verrà usato per le visite successive all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-193">As soon as the user closes your application (i.e., there are no remaining tabs or windows displaying your application), the new service worker becomes "active" and will be used for subsequent visits to your application.</span></span> <span data-ttu-id="6b1d2-194">Il servizio di lavoro precedente e la relativa cache vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-194">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="6b1d2-195">Se il processo non viene completato correttamente, la nuova istanza del ruolo di lavoro del servizio viene eliminata.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-195">If the process does not complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="6b1d2-196">Il processo di aggiornamento verrà nuovamente ritentato alla visita successiva dell'utente, quando si spera che dispongano di una connessione di rete migliore in grado di completare le richieste.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-196">The update process will be attempted again on the user's next visit, when hopefully they have a better network connection that can complete the requests.</span></span>

<span data-ttu-id="6b1d2-197">È possibile personalizzare qualsiasi aspetto di questo processo modificando la logica del ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-197">You can customize any aspect of this process by editing the service worker logic.</span></span> <span data-ttu-id="6b1d2-198">Nessuno dei precedenti è specifico per Blazor, ma è semplicemente un suggerimento fornito dall'opzione del modello PWA.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-198">None of the above is specific to Blazor, but is merely a suggestion provided by the PWA template option.</span></span> <span data-ttu-id="6b1d2-199">Per ulteriori informazioni, vedere la [documentazione del servizio Worker](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-199">See [service worker documentation](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) for more information.</span></span>

#### <a name="how-requests-are-resolved"></a><span data-ttu-id="6b1d2-200">Modalità di risoluzione delle richieste</span><span class="sxs-lookup"><span data-stu-id="6b1d2-200">How requests are resolved</span></span>

<span data-ttu-id="6b1d2-201">Come descritto in precedenza, il ruolo di lavoro predefinito del servizio utilizza una strategia di *cache-First* , ovvero tenta di gestire il contenuto memorizzato nella cache, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-201">As described above, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="6b1d2-202">Se non sono presenti contenuti memorizzati nella cache per un determinato URL, ad esempio quando si richiedono dati da un'API back-end, il ruolo di lavoro del servizio esegue il fallback su una normale richiesta di rete, che può avere esito positivo solo se il server è raggiungibile.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-202">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request which can only succeed if the server is reachable.</span></span> <span data-ttu-id="6b1d2-203">Questa logica viene implementata all'interno `onFetch` all'interno di *service-worker. Published. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-203">This logic is implemented inside `onFetch` within *service-worker.published.js*.</span></span>

<span data-ttu-id="6b1d2-204">Se i componenti Blazor si basano sulla richiesta di dati dalle API back-end e si desidera fornire un'esperienza utente intuitiva nel caso in cui tali richieste abbiano esito negativo a causa della mancata disponibilità della rete, è necessario implementare la logica all'interno dei componenti.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-204">If your Blazor components rely on requesting data from backend APIs, and you want to provide a friendly user experience in the case where such requests fail due to network unavailability, then you need to implement logic within your components.</span></span> <span data-ttu-id="6b1d2-205">Ad esempio, usare `try/catch` circa `HttpClient` richieste.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-205">For example, use `try/catch` around `HttpClient` requests.</span></span>

#### <a name="support-server-rendered-pages"></a><span data-ttu-id="6b1d2-206">Pagine di supporto per il rendering del server</span><span class="sxs-lookup"><span data-stu-id="6b1d2-206">Support server-rendered pages</span></span>

<span data-ttu-id="6b1d2-207">Si consideri cosa accade quando l'utente accede per la prima volta a un URL, ad esempio `/counter` o qualsiasi altro collegamento profondo nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-207">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link into your application.</span></span> <span data-ttu-id="6b1d2-208">In questi casi, non si vuole restituire contenuto memorizzato nella cache come `/counter`, ma è necessario che il browser carichi il contenuto memorizzato nella cache come `/index.html` per avviare l'applicazione di Blazor webassembly.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-208">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly application.</span></span> <span data-ttu-id="6b1d2-209">Queste richieste iniziali sono note come richieste di *navigazione* (in contrapposizione alle richieste di *sottorisorse* per immagini/CSS e così via o richieste di *recupero/XHR* per i dati dell'API).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-209">These initial requests are known as *navigation* requests (as opposed to *subresource* requests for images/CSS/etc, or *fetch/XHR* requests for API data).</span></span>

<span data-ttu-id="6b1d2-210">Il ruolo di lavoro del servizio predefinito contiene la logica speciale per le richieste di navigazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-210">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="6b1d2-211">Vengono risolti restituendo il contenuto memorizzato nella cache per `/index.html`, indipendentemente dall'URL richiesto.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-211">It resolves them by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="6b1d2-212">Questa logica viene implementata nella funzione `onFetch` all'interno di *service-worker. Published. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-212">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="6b1d2-213">Se l'applicazione dispone di determinati URL che devono restituire il codice HTML sottoposto a rendering del server (senza `/index.html` dalla cache), è necessario modificare la logica nel ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-213">If your application has certain URLs that must return server-rendered HTML (and not serve `/index.html` from the cache), then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="6b1d2-214">Se, ad esempio, tutti gli URL contenenti `/Identity/` devono essere gestiti come richieste normali solo in linea al server, modificare la logica di `onFetch` *service-worker. Published. js* .</span><span class="sxs-lookup"><span data-stu-id="6b1d2-214">For example, if all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="6b1d2-215">Individuare il codice riportato di seguito:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-215">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="6b1d2-216">Modificare il codice nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-216">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="6b1d2-217">Se non si esegue questa operazione, indipendentemente dalla connettività di rete, il ruolo di lavoro del servizio intercetta le richieste per tali URL e le risolve utilizzando `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-217">If you don't do this, then regardless of network connectivity, the service worker will intercept requests for such URLs and will resolve them using `/index.html`.</span></span>

#### <a name="control-asset-caching"></a><span data-ttu-id="6b1d2-218">Controllare la memorizzazione nella cache degli asset</span><span class="sxs-lookup"><span data-stu-id="6b1d2-218">Control asset caching</span></span>

<span data-ttu-id="6b1d2-219">Se il progetto definisce una proprietà MSBuild denominata `ServiceWorkerAssetsManifest`, gli strumenti di compilazione di Blazorgenereranno un manifesto delle risorse del ruolo di lavoro del servizio con il nome specificato.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-219">If your project defines an MSBuild property called `ServiceWorkerAssetsManifest`, then Blazor's build tooling will generate a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="6b1d2-220">Il modello predefinito di PWA produce un file di progetto contenente gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-220">The default PWA template produces a project file containing the following:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="6b1d2-221">Il file si trova nella directory di output *wwwroot* , quindi il browser può recuperare il file richiedendo `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-221">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="6b1d2-222">Per visualizzare il contenuto, aprire *YourProject\bin\Debug\netstandard2.1\wwwroot\service-Worker-assets.js* in un editor di testo.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-222">To see the contents, open *YourProject\bin\Debug\netstandard2.1\wwwroot\service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="6b1d2-223">Tuttavia, non modificare il file, perché verrà rigenerato in ogni compilazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-223">However, don't edit the file, as it will be regenerated on each build.</span></span>

<span data-ttu-id="6b1d2-224">Per impostazione predefinita, questo manifesto elenca:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-224">By default, this manifest lists:</span></span>

* <span data-ttu-id="6b1d2-225">Tutte le risorse gestite da Blazor, ad esempio gli assembly .NET e i file di runtime di .NET webassembly, necessari per il funzionamento offline</span><span class="sxs-lookup"><span data-stu-id="6b1d2-225">Any Blazor-managed resources such as .NET assemblies and the .NET WebAssembly runtime files needed to function offline</span></span>
* <span data-ttu-id="6b1d2-226">Tutte le risorse che verranno pubblicate nella directory *wwwroot* , ad esempio immagini, file CSS e file JavaScript.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-226">All resources that will be published in your *wwwroot* directory, such as images, CSS files, and JavaScript files.</span></span> <span data-ttu-id="6b1d2-227">Sono inclusi gli asset Web statici forniti da progetti esterni e pacchetti NuGet.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-227">This includes static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="6b1d2-228">È possibile controllare quali di queste risorse verranno recuperate e memorizzate nella cache dal ruolo di lavoro del servizio modificando la logica in `onInstall` in *service-worker. Published. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-228">You can control which of these resources will be fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="6b1d2-229">Per impostazione predefinita, i file vengono recuperati e memorizzati nella cache corrispondenti ad estensioni di file Web tipiche, ad esempio *HTML*, *CSS*, *JS*, *WASM*e altri, oltre ai tipi di file specifici per Blazor webassembly (con estensione*dll*, *PDB*).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-229">By default, it will fetch and cache files matching typical web filename extensions such as *.html*, *.css*, *.js*, *.wasm*, and others, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="6b1d2-230">Se si desidera includere risorse aggiuntive che non sono presenti nella directory *wwwroot* , è possibile eseguire questa operazione definendo voci ItemGroup MSBuild aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-230">If you want to include additional resources that aren't present in your *wwwroot* directory, you can do so by defining extra MSBuild itemgroup entries.</span></span> <span data-ttu-id="6b1d2-231">Nel file di progetto, ad esempio, aggiungere:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-231">For example, in your project file, add:</span></span>

```xml
<ItemGroup>
    <ServiceWorkerAssetsManifestItem
        Include="MyDirectory\AnotherFile.json"
        RelativePath="MyDirectory\AnotherFile.json"
        AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="6b1d2-232">I metadati di `AssetUrl` specificano l'URL relativo di base che il browser deve usare durante il recupero della risorsa nella cache.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-232">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="6b1d2-233">Questo può essere indipendente dal nome del file di origine originale sul disco.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-233">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6b1d2-234">L'aggiunta di un `ServiceWorkerAssetsManifestItem` non determina la pubblicazione del file nella directory *wwwroot*</span><span class="sxs-lookup"><span data-stu-id="6b1d2-234">Adding a `ServiceWorkerAssetsManifestItem` does not cause the file to be published in your *wwwroot* directory.</span></span> <span data-ttu-id="6b1d2-235">Consente di controllare l'output di pubblicazione separatamente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-235">It up to you to control your publish output separately.</span></span> <span data-ttu-id="6b1d2-236">Il `ServiceWorkerAssetsManifestItem` causa solo la visualizzazione di una voce aggiuntiva nel manifesto delle risorse del ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-236">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="6b1d2-237">Notifiche push</span><span class="sxs-lookup"><span data-stu-id="6b1d2-237">Push notifications</span></span>

<span data-ttu-id="6b1d2-238">Analogamente a qualsiasi altro PWA, un Blazor webassembly PWA può ricevere notifiche push da un server back-end.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-238">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="6b1d2-239">Il server può inviare questi elementi in qualsiasi momento, anche quando l'utente non usa attivamente l'applicazione (ad esempio, quando un altro utente esegue un'azione che può essere pertinente).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-239">Your server can send these at any time, even when the user is not actively using your application (for example, when a different user performs an action that may be relevant).</span></span>

<span data-ttu-id="6b1d2-240">Il meccanismo per l'invio di una notifica push è interamente indipendente da Blazor webassembly, dal momento che è implementato dal server back-end che può usare qualsiasi tecnologia.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-240">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="6b1d2-241">Se si desidera inviare notifiche push da un server di ASP.NET Core, è consigliabile [utilizzare una tecnica simile a quella del workshop di pizza ardente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-241">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to that in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="6b1d2-242">Il meccanismo per la ricezione e la visualizzazione di una notifica push sul client è anche indipendente da Blazor webassembly, dal momento che è implementato nel servizio Worker, che è un file JavaScript.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-242">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker, which is a JavaScript file.</span></span> <span data-ttu-id="6b1d2-243">Ad esempio, è possibile vedere di nuovo [l'approccio usato nell'officina della pizza ardente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-243">As an example, you can again see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="6b1d2-244">Avvertenze per PWA offline</span><span class="sxs-lookup"><span data-stu-id="6b1d2-244">Caveats for offline PWAs</span></span>

<span data-ttu-id="6b1d2-245">Non tutte le applicazioni devono provare a supportare l'uso offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-245">Not all applications should attempt to support offline use.</span></span> <span data-ttu-id="6b1d2-246">Viene aggiunta una complessità significativa, sebbene non sempre pertinente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-246">It adds significant complexity, while not always being relevant.</span></span>

<span data-ttu-id="6b1d2-247">Il supporto offline è in genere rilevante solo:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-247">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="6b1d2-248">Se l'archivio dati primario è locale nel browser.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-248">If your primary data store is local to the browser.</span></span> <span data-ttu-id="6b1d2-249">Ad esempio, quando si compila un'interfaccia utente per [un dispositivo Internet](https://en.wikipedia.org/wiki/Internet_of_things) delle cose che archivia i dati in `localStorage` o [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-249">For example, when building a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>

* <span data-ttu-id="6b1d2-250">Se si esegue un lavoro significativo per recuperare e memorizzare nella cache i dati dell'API back-end rilevanti per ogni utente, in modo da poterli esplorare offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-250">If you do significant work to fetch and cache the backend API data relevant to each user, so they can navigate through it offline.</span></span> <span data-ttu-id="6b1d2-251">Se si supporta la modifica, sarà anche necessario compilare un sistema per tenere traccia delle modifiche e sincronizzarle con il back-end.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-251">If you support editing, you will also need to build a system for tracking changes and synchronizing them with the backend.</span></span>

* <span data-ttu-id="6b1d2-252">Se l'obiettivo è garantire il caricamento immediato dell'applicazione indipendentemente dalle condizioni della rete.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-252">If your goal is to guarantee the application loads immediately regardless of network conditions.</span></span> <span data-ttu-id="6b1d2-253">Sarà quindi necessario implementare un'esperienza utente adatta alle richieste dell'API back-end per mostrare lo stato di avanzamento delle richieste e comportarsi in modo normale quando hanno esito negativo a causa della mancata disponibilità della rete.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-253">You will then need to implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when they fail due to network unavailability.</span></span>

<span data-ttu-id="6b1d2-254">Inoltre, le PWA con supporto offline devono gestire una serie di complicazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-254">Additionally, offline-capable PWAs need to deal with a range of extra complications.</span></span> <span data-ttu-id="6b1d2-255">Gli sviluppatori devono acquisire familiarità con attenzione con le avvertenze seguenti.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-255">Developers should carefully familiarize themselves with the following caveats.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="6b1d2-256">Supporto offline solo dopo la pubblicazione</span><span class="sxs-lookup"><span data-stu-id="6b1d2-256">Offline support only when published</span></span>

<span data-ttu-id="6b1d2-257">il modello PWA di Blazorconsente il supporto offline solo dopo la pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-257">Blazor's PWA template enables offline support only when published.</span></span> <span data-ttu-id="6b1d2-258">Il motivo è che, durante lo sviluppo, in genere si desidera visualizzare ogni modifica riflessa immediatamente nel browser, senza passare attraverso un processo di aggiornamento in background.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-258">This is because, during development, you typically want to see each change reflected immediately in the browser, without going through a background update process.</span></span>

<span data-ttu-id="6b1d2-259">Pertanto, quando si compila un'applicazione che supporta offline, non è sufficiente testare l'applicazione in modalità di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-259">Therefore when building an offline-capable application, it's not enough to test your application in development mode.</span></span> <span data-ttu-id="6b1d2-260">È necessario testare l'applicazione nello stato pubblicato per comprendere come risponderà a condizioni di rete diverse.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-260">You must test your application in its published state to understand how it will respond to differing network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="6b1d2-261">Completamento dell'aggiornamento dopo la navigazione dell'utente dall'app</span><span class="sxs-lookup"><span data-stu-id="6b1d2-261">Update completion after user navigation away from app</span></span>

<span data-ttu-id="6b1d2-262">Gli aggiornamenti non vengono completati fino a quando l'utente non si è spostato dall'applicazione in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-262">Updates don't complete until the user has navigated away from your application in all tabs.</span></span> <span data-ttu-id="6b1d2-263">Come illustrato negli [aggiornamenti in background](#background-updates), dopo la distribuzione di un aggiornamento nell'applicazione, il browser recupererà i file di lavoro del servizio aggiornati e avvierà un processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-263">As explained in [Background updates](#background-updates), after you deploy an update to your application, the browser will fetch the updated service worker files and begin an update process.</span></span>

<span data-ttu-id="6b1d2-264">Quali sono le sorprese che molti sviluppatori, anche al termine dell'aggiornamento, diventano effettive fino a quando l'utente **non** si è spostato in tutte le schede.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-264">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="6b1d2-265">**Non** è sufficiente aggiornare la scheda visualizzando l'applicazione, anche se è l'unica scheda che Visualizza l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-265">It is **not** sufficient to refresh the tab displaying your application, even if it's the only tab displaying your application.</span></span> <span data-ttu-id="6b1d2-266">Finché l'applicazione non viene chiusa completamente, il nuovo ruolo di lavoro del servizio rimarrà in stato "in attesa di attivazione".</span><span class="sxs-lookup"><span data-stu-id="6b1d2-266">Until your application is completely closed, the new service worker will remain in a "waiting to activate" status.</span></span> <span data-ttu-id="6b1d2-267">**Questo non è specifico per Blazor, ma è piuttosto un comportamento standard della piattaforma Web.**</span><span class="sxs-lookup"><span data-stu-id="6b1d2-267">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="6b1d2-268">Questo problema si verifica in genere dagli sviluppatori che tentano di testare gli aggiornamenti al ruolo di lavoro del servizio o alle risorse nella cache offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-268">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="6b1d2-269">Se si archiviano gli strumenti di sviluppo del browser, è possibile che venga visualizzato un risultato simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="6b1d2-269">If you check in the browser's dev tools, you may see something like the following:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76226394-b93f7380-6215-11ea-8572-7d52afee2dd8.png)

<span data-ttu-id="6b1d2-271">Per il periodo di tempo in cui l'elenco dei "client" (ovvero le schede o le finestre che visualizzano l'applicazione) non è vuoto, il thread di lavoro continuerà ad attendere.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-271">For as long as the list of "clients" (i.e., tabs or windows displaying your application) is nonempty, the worker will continue waiting.</span></span> <span data-ttu-id="6b1d2-272">Il motivo per cui i dipendenti del servizio eseguono questa operazione è garantire la coerenza, ovvero, che tutte le risorse vengono recuperate dalla stessa cache atomica.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-272">The reason service workers do this is to guarantee consistency, i.e., that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="6b1d2-273">Quando si verificano le modifiche, può essere utile fare clic sul collegamento "skipWaiting", come illustrato nella schermata precedente, quindi ricaricare la pagina.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-273">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the screenshot above, then reload the page.</span></span> <span data-ttu-id="6b1d2-274">Se lo si desidera, è possibile automatizzare questa operazione per tutti gli utenti codificando il ruolo di lavoro del servizio in modo da [ignorare la fase di attesa e attivare immediatamente l'aggiornamento](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-274">If you want, you can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="6b1d2-275">Tuttavia, se si esegue questa operazione, si cede la garanzia che le risorse vengano sempre recuperate in modo coerente dalla stessa istanza della cache.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-275">However if you do this, you are giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="6b1d2-276">Gli utenti possono eseguire qualsiasi versione cronologica dell'app</span><span class="sxs-lookup"><span data-stu-id="6b1d2-276">Users may run any historical version of the app</span></span>

<span data-ttu-id="6b1d2-277">Gli sviluppatori Web si aspettano abitualmente che gli utenti eseguano solo la versione distribuita più recente della propria applicazione Web, dal momento che si tratta di una situazione normale nel modello di distribuzione Web tradizionale.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-277">Web developers habitually expect that users will only run the latest deployed version of their web application, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="6b1d2-278">Tuttavia, un PWA per la prima volta offline è più simile a un'app per dispositivi mobili nativa, in cui gli utenti non eseguono necessariamente la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-278">However, an offline-first PWA is more akin to a native mobile app, where users are not necessarily running the latest version.</span></span>

<span data-ttu-id="6b1d2-279">Come spiegato negli [aggiornamenti in background](#background-updates), dopo la distribuzione di un aggiornamento nell'applicazione, **ogni utente esistente continuerà a usare una versione precedente per almeno un'altra visita** (poiché l'aggiornamento viene eseguito in background e non viene attivato fino a quando l'utente non si sposta).</span><span class="sxs-lookup"><span data-stu-id="6b1d2-279">As explained in [Background updates](#background-updates), after you deploy an update to your application, **each existing user will continue to use a previous version for at least one further visit** (because the update occurs in the background and isn't activated until the user then navigates away).</span></span> <span data-ttu-id="6b1d2-280">Inoltre, la versione precedente utilizzata non è necessariamente quella precedente distribuita. può trattarsi di *qualsiasi* versione cronologica, a seconda del momento in cui l'utente ha completato un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-280">Plus, the previous version being used isn't necessarily the previous one you deployed - it can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="6b1d2-281">Questo può essere un problema se le parti front-end e back-end dell'applicazione richiedono un accordo sullo schema per le richieste API.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-281">This can be an issue if the frontend and backend parts of your application require agreement about the schema for API requests.</span></span> <span data-ttu-id="6b1d2-282">Non è necessario distribuire le modifiche allo schema API non compatibili con le versioni precedenti fino a quando non si è certi che tutti gli utenti abbiano eseguito l'aggiornamento o che almeno gli utenti non possano usare versioni precedenti dell'app incompatibili.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-282">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded, or at least block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="6b1d2-283">Questo è proprio come un'app per dispositivi mobili nativa.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-283">This is just like a native mobile app.</span></span> <span data-ttu-id="6b1d2-284">Se si distribuisce una modifica di rilievo nelle API del server, l'app client verrà interrotta per gli utenti che non hanno ancora eseguito l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-284">If you deploy a breaking change in server APIs, the client app will be broken for people who haven't yet updated.</span></span>

<span data-ttu-id="6b1d2-285">Se possibile, non distribuire le modifiche di rilievo alle API back-end.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-285">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="6b1d2-286">Tuttavia, se è necessario eseguire questa operazione, è consigliabile utilizzare le [API di lavoro del servizio standard, ad esempio `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) per determinare se l'applicazione è aggiornata e, in caso contrario, per impedire l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-286">But if you must do so, consider using [standard Service Worker APIs such as `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the application is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="6b1d2-287">Interferenze con le pagine sottoposte a rendering server</span><span class="sxs-lookup"><span data-stu-id="6b1d2-287">Interference with server-rendered pages</span></span>

<span data-ttu-id="6b1d2-288">[Come descritto in precedenza](#support-server-rendered-pages), se si desidera ignorare il comportamento del ruolo di lavoro del servizio per restituire `/index.html` contenuto per tutte le richieste di navigazione, è necessario modificare la logica nel ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-288">[As described above](#support-server-rendered-pages), if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, you need to edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="6b1d2-289">Tutti i contenuti del manifesto dell'asset del servizio di lavoro vengono memorizzati nella cache</span><span class="sxs-lookup"><span data-stu-id="6b1d2-289">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="6b1d2-290">[Come descritto in precedenza](#control-asset-caching), il file *service-worker-assets. js* viene generato durante la compilazione ed elenca tutti gli asset che devono essere recuperati e memorizzati nella cache dal ruolo di lavoro del servizio.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-290">[As described above](#control-asset-caching), the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="6b1d2-291">Poiché per impostazione predefinita questo elenco include tutti gli elementi emessi in *wwwroot* (incluso il contenuto fornito da pacchetti e progetti esterni), è necessario prestare attenzione a non inserire troppi contenuti.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-291">Since this list by default includes everything emitted to *wwwroot* (including content supplied by external packages and projects), you must be careful not to put too much content there.</span></span> <span data-ttu-id="6b1d2-292">Se ad esempio la directory *wwwroot* contiene milioni di immagini, il ruolo di lavoro del servizio tenterà di recuperarli e memorizzarli nella cache, consumando una larghezza di banda eccessiva e probabilmente non verrà completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-292">If for example your *wwwroot* directory contains millions of images, the service worker would try to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="6b1d2-293">È possibile implementare una logica arbitraria per controllare quale subset del contenuto del manifesto deve essere recuperato e memorizzato nella cache modificando la funzione `onInstall` in *service-worker. Published. js*.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-293">You can implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="6b1d2-294">Interazione con l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="6b1d2-294">Interaction with authentication</span></span>

<span data-ttu-id="6b1d2-295">È possibile utilizzare l'opzione del modello PWA insieme alle opzioni di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-295">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="6b1d2-296">Un PWA con supporto offline può inoltre supportare l'autenticazione quando l'utente dispone di connettività di rete.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-296">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="6b1d2-297">Tuttavia, quando un utente non dispone di connettività di rete, non sarà in grado di autenticare o ottenere i token di accesso.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-297">However, when a user does not have network connectivity, they will not be able to authenticate or obtain access tokens.</span></span> <span data-ttu-id="6b1d2-298">Se si tenta di visitare la pagina "login", per impostazione predefinita viene visualizzato un messaggio che indica "errore di rete".</span><span class="sxs-lookup"><span data-stu-id="6b1d2-298">Attempting to visit the "login" page will by default display a message saying "network error".</span></span>

<span data-ttu-id="6b1d2-299">Di conseguenza, è il processo di progettazione di un flusso dell'interfaccia utente che consente all'utente di eseguire operazioni utili in modalità offline senza provare ad autenticare o ottenere i token di accesso o almeno in caso di errore in modo normale.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-299">As such it's your job to design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens, or at least failing in a graceful way in those cases.</span></span> <span data-ttu-id="6b1d2-300">Se l'applicazione non è possibile, è possibile che non si desideri abilitare il supporto offline.</span><span class="sxs-lookup"><span data-stu-id="6b1d2-300">If this isn't possible in your application, you might not want to enable offline support.</span></span>
