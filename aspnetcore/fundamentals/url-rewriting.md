---
title: Middleware Riscrittura URL in ASP.NET Core
author: rick-anderson
description: Informazioni sulla riscrittura e il reindirizzamento di URL con il middleware Riscrittura URL nelle applicazioni ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/16/2019
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/url-rewriting
ms.openlocfilehash: e7bd5f4d61661dd23eb0907f896d0d32b7799aac
ms.sourcegitcommit: 3593c4efa707edeaaceffbfa544f99f41fc62535
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/04/2021
ms.locfileid: "93061301"
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="3c207-103">Middleware Riscrittura URL in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="3c207-103">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="3c207-104">Di [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="3c207-104">By [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="3c207-105">Questo documento presenta la riscrittura URL con istruzioni per l'uso del middleware Riscrittura URL nelle applicazioni ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="3c207-105">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="3c207-106">La riscrittura URL è l'azione di modificare gli URL di richiesta in base a una o più regole predefinite.</span><span class="sxs-lookup"><span data-stu-id="3c207-106">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="3c207-107">Il processo di riscrittura URL crea un'astrazione tra i percorsi delle risorse e i relativi indirizzi, in modo che i percorsi e gli indirizzi non risultino strettamente collegati.</span><span class="sxs-lookup"><span data-stu-id="3c207-107">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="3c207-108">La riscrittura URL risulta utile in diversi scenari per:</span><span class="sxs-lookup"><span data-stu-id="3c207-108">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="3c207-109">Spostare o sostituire in modo temporaneo o permanente risorse server mantenendo localizzatori stabili di queste risorse.</span><span class="sxs-lookup"><span data-stu-id="3c207-109">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="3c207-110">Suddividere l'elaborazione delle richieste tra app diverse o tra aree diverse di un'unica app.</span><span class="sxs-lookup"><span data-stu-id="3c207-110">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="3c207-111">Rimuovere, aggiungere o riorganizzare segmenti URL nelle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-111">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="3c207-112">Ottimizzare gli URL pubblici per l'ottimizzazione motore di ricerca (SEO, Search Engine Optimization).</span><span class="sxs-lookup"><span data-stu-id="3c207-112">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="3c207-113">Consentire l'uso di URL pubblici descrittivi in modo che i visitatori possano prevedere il contenuto restituito dalla richiesta di una risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-113">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="3c207-114">Reindirizzare le richieste non protette a endpoint protetti.</span><span class="sxs-lookup"><span data-stu-id="3c207-114">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="3c207-115">Evitare l'hotlinking, ovvero l'uso da parte di un sito esterno di una risorsa statica ospitata presente in un altro sito tramite il collegamento di questa al proprio contenuto.</span><span class="sxs-lookup"><span data-stu-id="3c207-115">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-116">La riscrittura URL può ridurre le prestazioni di un'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-116">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="3c207-117">Ove possibile, limitare il numero e la complessità delle regole.</span><span class="sxs-lookup"><span data-stu-id="3c207-117">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="3c207-118">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="3c207-118">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="3c207-119">Reindirizzamento URL e riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-119">URL redirect and URL rewrite</span></span>

<span data-ttu-id="3c207-120">La differenza tra i termini *reindirizzamento URL* e *riscrittura URL* è minima, ma ha implicazioni importanti nell'offerta di risorse ai clienti.</span><span class="sxs-lookup"><span data-stu-id="3c207-120">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="3c207-121">Il middleware Riscrittura URL di ASP.NET Core è in grado di svolgere entrambe le funzioni.</span><span class="sxs-lookup"><span data-stu-id="3c207-121">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="3c207-122">Un *reindirizzamento URL* implica un'operazione lato client, in cui viene richiesto al client di accedere a una risorsa a un indirizzo diverso da quello richiesto originariamente dal client.</span><span class="sxs-lookup"><span data-stu-id="3c207-122">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="3c207-123">Questa operazione richiede un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-123">This requires a round trip to the server.</span></span> <span data-ttu-id="3c207-124">L'URL di reindirizzamento restituito al client viene visualizzato nella barra degli indirizzi del browser quando il client effettua una nuova richiesta per la risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-124">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="3c207-125">In caso di *reindirizzamento* di `/resource` a `/different-resource`, il server risponde che il client deve ottenere la risorsa presso `/different-resource` con un codice di stato che indica se il reindirizzamento è temporaneo o permanente.</span><span class="sxs-lookup"><span data-stu-id="3c207-125">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Un endpoint di servizio WebAPI è stato modificato temporaneamente dalla versione 1 (v1) alla versione 2 (v2) nel server.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="3c207-131">Quando si reindirizzano le richieste a un URL diverso, indicare se il reindirizzamento è temporaneo o permanente specificando il codice di stato con la risposta:</span><span class="sxs-lookup"><span data-stu-id="3c207-131">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="3c207-132">Il codice di stato *301 - Spostato permanentemente* viene usato se la risorsa ha un nuovo URL definitivo e si vuole indicare al client che tale URL dovrà essere usato per tutte le richieste future della risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-132">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="3c207-133">*Quando riceve un codice di stato 301, il client può memorizzare la risposta nella cache e riusarla.*</span><span class="sxs-lookup"><span data-stu-id="3c207-133">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="3c207-134">Il codice di stato *302 - Trovato* viene usato quando il reindirizzamento è temporaneo o comunque soggetto a modifiche.</span><span class="sxs-lookup"><span data-stu-id="3c207-134">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="3c207-135">Il codice di stato 302 indica che il client non dovrà archiviare e riusare l'URL di reindirizzamento in futuro.</span><span class="sxs-lookup"><span data-stu-id="3c207-135">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="3c207-136">Per altre informazioni sui codici di stato, vedere [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) (RFC 2616: Definizioni dei codici di stato).</span><span class="sxs-lookup"><span data-stu-id="3c207-136">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="3c207-137">La *riscrittura URL* è un'operazione lato server che rende disponibile una risorsa da un indirizzo diverso da quello richiesto dal client.</span><span class="sxs-lookup"><span data-stu-id="3c207-137">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="3c207-138">La riscrittura URL non richiede un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-138">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="3c207-139">L'URL riscritto non viene restituito al client e non viene visualizzato nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="3c207-139">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="3c207-140">Se `/resource` viene *riscritto* in `/different-resource`, il server recupera *internamente* la risorsa in `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="3c207-140">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="3c207-141">Anche se il client fosse in grado di recuperare la risorsa nell'URL riscritto, non viene informato dell'esistenza della risorsa nell'URL riscritto quando effettua la richiesta e riceve la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-141">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Un endpoint servizio WebAPI è stato modificato dalla versione 1 (v1) alla versione 2 (v2) sul server.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="3c207-146">App di esempio per la riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-146">URL rewriting sample app</span></span>

<span data-ttu-id="3c207-147">È possibile esplorare le funzionalità del middleware Riscrittura URL con l'[app di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="3c207-147">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="3c207-148">L'app applica regole di reindirizzamento e riscrittura e visualizza l'URL reindirizzato o riscritto per diversi scenari.</span><span class="sxs-lookup"><span data-stu-id="3c207-148">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="3c207-149">Quando usare il middleware Riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-149">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="3c207-150">Usare il middleware Riscrittura URL quando non è possibile usare gli approcci seguenti:</span><span class="sxs-lookup"><span data-stu-id="3c207-150">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="3c207-151">URL Rewrite Module for IIS in Windows Server</span><span class="sxs-lookup"><span data-stu-id="3c207-151">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="3c207-152">Modulo Apache mod_rewrite in Apache Server</span><span class="sxs-lookup"><span data-stu-id="3c207-152">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="3c207-153">Riscrittura URL in Nginx</span><span class="sxs-lookup"><span data-stu-id="3c207-153">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="3c207-154">Usare il middleware anche se l'app è ospitata in un [server HTTP.sys](xref:fundamentals/servers/httpsys) (in precedenza denominato WebListener).</span><span class="sxs-lookup"><span data-stu-id="3c207-154">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="3c207-155">I motivi principali per usare tecnologie di riscrittura URL basate su server in IIS, Apache e Nginx sono:</span><span class="sxs-lookup"><span data-stu-id="3c207-155">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="3c207-156">Il middleware non supporta tutte le funzionalità di questi moduli.</span><span class="sxs-lookup"><span data-stu-id="3c207-156">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="3c207-157">Alcune funzionalità dei moduli server non funzionano con i progetti ASP.NET Core, ad esempio i vincoli `IsFile` e `IsDirectory` del modulo IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="3c207-157">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="3c207-158">In questi scenari è necessario usare il middleware.</span><span class="sxs-lookup"><span data-stu-id="3c207-158">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="3c207-159">Le prestazioni del middleware probabilmente non corrispondono a quelle dei moduli.</span><span class="sxs-lookup"><span data-stu-id="3c207-159">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="3c207-160">Il benchmarking rappresenta l'unico modo per sapere con certezza quale approccio comporta la maggior riduzione delle prestazioni o se tale riduzione è trascurabile.</span><span class="sxs-lookup"><span data-stu-id="3c207-160">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="3c207-161">Pacchetto</span><span class="sxs-lookup"><span data-stu-id="3c207-161">Package</span></span>

<span data-ttu-id="3c207-162">Il middleware di riscrittura URL è fornito dal pacchetto [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite), implicitamente incluso nelle app ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="3c207-162">URL Rewriting Middleware is provided by the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package, which is implicitly included in ASP.NET Core apps.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="3c207-163">Estensioni e opzioni</span><span class="sxs-lookup"><span data-stu-id="3c207-163">Extension and options</span></span>

<span data-ttu-id="3c207-164">È possibile definire regole di riscrittura e reindirizzamento URL creando un'istanza della classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) con metodi di estensione per le singole regole di riscrittura.</span><span class="sxs-lookup"><span data-stu-id="3c207-164">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="3c207-165">Concatenare più regole nell'ordine in cui si vuole che vengano elaborate.</span><span class="sxs-lookup"><span data-stu-id="3c207-165">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="3c207-166">Le opzioni `RewriteOptions` vengono passate al middleware Riscrittura URL quando questo viene aggiunto alla pipeline della richiesta con <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="3c207-166">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="3c207-167">Reindirizzare non-www su www</span><span class="sxs-lookup"><span data-stu-id="3c207-167">Redirect non-www to www</span></span>

<span data-ttu-id="3c207-168">Sono disponibili tre opzioni che consentono all'app di reindirizzare richieste non-`www` su `www`:</span><span class="sxs-lookup"><span data-stu-id="3c207-168">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="3c207-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>: Reindirizza in modo permanente la richiesta al `www` sottodominio se la richiesta è non `www` .</span><span class="sxs-lookup"><span data-stu-id="3c207-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>: Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="3c207-170">Reindirizza con un codice di stato [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="3c207-170">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="3c207-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>: Reindirizza la richiesta al `www` sottodominio se la richiesta in ingresso è non `www` .</span><span class="sxs-lookup"><span data-stu-id="3c207-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>: Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="3c207-172">Reindirizza con un codice di stato [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="3c207-172">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="3c207-173">Un overload consente di specificare il codice di stato per la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-173">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="3c207-174">Usare un campo della classe <xref:Microsoft.AspNetCore.Http.StatusCodes> per un'assegnazione di codice di stato.</span><span class="sxs-lookup"><span data-stu-id="3c207-174">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="3c207-175">Reindirizzamento URL</span><span class="sxs-lookup"><span data-stu-id="3c207-175">URL redirect</span></span>

<span data-ttu-id="3c207-176">Per reindirizzare le richieste, usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="3c207-177">Il primo parametro contiene l'espressione regolare per la corrispondenza in base al percorso dell'URL in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-177">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="3c207-178">Il secondo parametro è la stringa di sostituzione.</span><span class="sxs-lookup"><span data-stu-id="3c207-178">The second parameter is the replacement string.</span></span> <span data-ttu-id="3c207-179">Il terzo parametro, se presente, specifica il codice di stato.</span><span class="sxs-lookup"><span data-stu-id="3c207-179">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="3c207-180">Se il codice di stato non è specificato, assume come valore predefinito *302 - Trovato*, che indica che la risorsa è stata temporaneamente spostata o sostituita.</span><span class="sxs-lookup"><span data-stu-id="3c207-180">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="3c207-181">In un browser con gli strumenti di sviluppo abilitati, creare una richiesta all'app di esempio con il percorso `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-181">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="3c207-182">L'espressione regolare definisce la corrispondenza con il percorso di richiesta in `redirect-rule/(.*)` e il percorso viene sostituito con `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-182">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="3c207-183">L'URL di reindirizzamento viene restituito al client con il codice di stato *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-183">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="3c207-184">Il browser invia una nuova richiesta all'URL di reindirizzamento, che viene visualizzata nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="3c207-184">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="3c207-185">Poiché nessuna regola nell'app di esempio corrisponde all'URL di reindirizzamento:</span><span class="sxs-lookup"><span data-stu-id="3c207-185">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="3c207-186">La seconda richiesta riceve una risposta *200 - OK* dall'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-186">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="3c207-187">Il corpo della risposta visualizza l'URL di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-187">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="3c207-188">Quando un URL viene *reindirizzato*, viene eseguito un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-188">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="3c207-189">Prestare attenzione quando si definiscono regole di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-189">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="3c207-190">Le regole di reindirizzamento vengono valutate in ogni richiesta all'app, anche dopo un reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-190">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="3c207-191">È facile creare inavvertitamente un *ciclo di reindirizzamento infinito*.</span><span class="sxs-lookup"><span data-stu-id="3c207-191">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="3c207-192">Richiesta originale: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="3c207-192">Original Request: `/redirect-rule/1234/5678`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="3c207-194">La parte dell'espressione racchiusa tra parentesi è denominata *gruppo Capture*.</span><span class="sxs-lookup"><span data-stu-id="3c207-194">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="3c207-195">Il punto (`.`) dell'espressione significa *corrispondenza con qualsiasi carattere*.</span><span class="sxs-lookup"><span data-stu-id="3c207-195">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="3c207-196">L'asterisco (`*`) indica *corrispondenza con il carattere precedente per zero o più volte*.</span><span class="sxs-lookup"><span data-stu-id="3c207-196">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="3c207-197">Di conseguenza gli ultimi due i segmenti di percorso dell'URL `1234/5678` vengono acquisiti tramite il gruppo Capture `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="3c207-197">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="3c207-198">Qualsiasi valore visualizzato nell'URL della richiesta dopo `redirect-rule/` viene acquisito da questo gruppo Capture.</span><span class="sxs-lookup"><span data-stu-id="3c207-198">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="3c207-199">Nella stringa di sostituzione i gruppi acquisiti vengono inseriti nella stringa con il simbolo di dollaro (`$`) seguito dal numero di sequenza dell'acquisizione.</span><span class="sxs-lookup"><span data-stu-id="3c207-199">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="3c207-200">Il primo valore del gruppo Capture viene ottenuto con `$1`, il secondo con `$2` e la procedura continua in sequenza per i gruppi Capture presenti nell'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="3c207-200">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="3c207-201">Nell'espressione regolare della regola di reindirizzamento dell'app di esempio è presente un solo gruppo acquisito, pertanto nella stringa di sostituzione è presente un solo gruppo inserito, ovvero `$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-201">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="3c207-202">Quando viene applicata la regola, l'URL diventa `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-202">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="3c207-203">Reindirizzamento URL a un endpoint protetto</span><span class="sxs-lookup"><span data-stu-id="3c207-203">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="3c207-204">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> per reindirizzare le richieste HTTP allo stesso host e allo stesso percorso tramite il protocollo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3c207-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="3c207-205">Se il codice di stato non viene specificato, il middleware usa come valore predefinito *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-205">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="3c207-206">Se non viene specificata la porta:</span><span class="sxs-lookup"><span data-stu-id="3c207-206">If the port isn't supplied:</span></span>

* <span data-ttu-id="3c207-207">Il middleware usa come valore predefinito `null`.</span><span class="sxs-lookup"><span data-stu-id="3c207-207">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="3c207-208">Lo schema viene modificato in `https` (protocollo HTTPS) e il client accede alla risorsa attraverso la porta 443.</span><span class="sxs-lookup"><span data-stu-id="3c207-208">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="3c207-209">L'esempio seguente illustra come impostare il codice di stato su *301 - Spostato permanentemente* e come passare alla porta 5001.</span><span class="sxs-lookup"><span data-stu-id="3c207-209">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="3c207-210">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> per reindirizzare le richieste non protette allo stesso host e allo stesso percorso con il protocollo protetto HTTPS attraverso la porta 443.</span><span class="sxs-lookup"><span data-stu-id="3c207-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="3c207-211">Il middleware imposta il codice di stato su *301 - Spostato permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="3c207-211">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="3c207-212">Per il reindirizzamento a un endpoint protetto quando non sono richieste regole di reindirizzamento aggiuntive, è consigliabile usare il middleware di reindirizzamento HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3c207-212">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="3c207-213">Per altre informazioni, vedere l'argomento [Imporre HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="3c207-213">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="3c207-214">L'app di esempio indica come usare `AddRedirectToHttps` o `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="3c207-214">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="3c207-215">Aggiungere il metodo di estensione a `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="3c207-215">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="3c207-216">Eseguire una richiesta non sicura all'app su qualsiasi URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-216">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="3c207-217">Ignorare l'avviso di sicurezza del browser indicante che il certificato autofirmato non è attendibile oppure creare un'eccezione per rendere affidabile il certificato.</span><span class="sxs-lookup"><span data-stu-id="3c207-217">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="3c207-218">Richiesta originale con `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="3c207-218">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="3c207-220">Richiesta originale con `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="3c207-220">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="3c207-222">Riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-222">URL rewrite</span></span>

<span data-ttu-id="3c207-223">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> per creare una regola di riscrittura URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="3c207-224">Il primo parametro contiene l'espressione regolare per la corrispondenza in base al percorso dell'URL in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-224">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="3c207-225">Il secondo parametro è la stringa di sostituzione.</span><span class="sxs-lookup"><span data-stu-id="3c207-225">The second parameter is the replacement string.</span></span> <span data-ttu-id="3c207-226">Il terzo parametro, `skipRemainingRules: {true|false}`, indica al middleware se ignorare le regole di riscrittura aggiuntive quando viene applicata la regola corrente.</span><span class="sxs-lookup"><span data-stu-id="3c207-226">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="3c207-227">Richiesta originale: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="3c207-227">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richiesta e risposta](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="3c207-229">L'accento circonflesso (`^`) all'inizio dell'espressione indica che la corrispondenza inizia all'inizio del percorso dell'URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-229">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="3c207-230">Nell'esempio precedente della regola di reindirizzamento `redirect-rule/(.*)`, non è presente l'accento circonflesso (`^`) all'inizio dell'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="3c207-230">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="3c207-231">È quindi possibile ottenere una corrispondenza anteponendo qualsiasi carattere a `redirect-rule/`.</span><span class="sxs-lookup"><span data-stu-id="3c207-231">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="3c207-232">Percorso</span><span class="sxs-lookup"><span data-stu-id="3c207-232">Path</span></span>                               | <span data-ttu-id="3c207-233">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-233">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="3c207-234">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-234">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="3c207-235">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-235">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="3c207-236">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-236">Yes</span></span>   |

<span data-ttu-id="3c207-237">La regola di riscrittura, `^rewrite-rule/(\d+)/(\d+)`, rileva la corrispondenza dei percorsi solo se iniziano con `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="3c207-237">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="3c207-238">Nella tabella seguente, si noti la differenza nella corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="3c207-238">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="3c207-239">Percorso</span><span class="sxs-lookup"><span data-stu-id="3c207-239">Path</span></span>                              | <span data-ttu-id="3c207-240">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-240">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="3c207-241">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-241">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="3c207-242">No</span><span class="sxs-lookup"><span data-stu-id="3c207-242">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="3c207-243">No</span><span class="sxs-lookup"><span data-stu-id="3c207-243">No</span></span>    |

<span data-ttu-id="3c207-244">Dopo la parte `^rewrite-rule/` dell'espressione sono presenti due gruppi Capture, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="3c207-244">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="3c207-245">`\d` indica *corrispondenza con una cifra (numero)*.</span><span class="sxs-lookup"><span data-stu-id="3c207-245">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="3c207-246">Il segno più (`+`) indica *corrispondenza con uno o più dei caratteri precedenti*.</span><span class="sxs-lookup"><span data-stu-id="3c207-246">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="3c207-247">Di conseguenza l'URL deve contenere un numero seguito da una barra seguita a sua volta da un altro numero.</span><span class="sxs-lookup"><span data-stu-id="3c207-247">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="3c207-248">Questi gruppi Capture vengono inseriti nell'URL riscritto come `$1` e `$2`.</span><span class="sxs-lookup"><span data-stu-id="3c207-248">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="3c207-249">La stringa di sostituzione della regola di riscrittura inserisce i gruppi acquisiti nella stringa di query.</span><span class="sxs-lookup"><span data-stu-id="3c207-249">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="3c207-250">Il percorso richiesto `/rewrite-rule/1234/5678` viene riscritto per ottenere la risorsa in `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-250">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="3c207-251">Se nella richiesta originale è presente una stringa di query, la stringa viene mantenuta quando l'URL viene riscritto.</span><span class="sxs-lookup"><span data-stu-id="3c207-251">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="3c207-252">Non viene eseguito alcun round trip al server per ottenere la risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-252">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="3c207-253">Se la risorsa esiste, viene recuperata e restituita al client con il codice di stato *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="3c207-253">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="3c207-254">Poiché il client non è reindirizzato, l'URL nella barra degli indirizzi del browser non cambia.</span><span class="sxs-lookup"><span data-stu-id="3c207-254">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="3c207-255">I client non sono in grado di rilevare che si è verificata un'operazione di riscrittura URL nel server.</span><span class="sxs-lookup"><span data-stu-id="3c207-255">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-256">Se possibile, usare sempre `skipRemainingRules: true`, perché la corrispondenza tra le regole è onerosa dal punto di vista del calcolo e aumenta il tempo di risposta dell'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-256">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="3c207-257">Per velocizzare il tempo di risposta dell'app:</span><span class="sxs-lookup"><span data-stu-id="3c207-257">For the fastest app response:</span></span>
>
> * <span data-ttu-id="3c207-258">Ordinare le regole di riscrittura dalla regola che origina più corrispondenze a quella che origina meno corrispondenze.</span><span class="sxs-lookup"><span data-stu-id="3c207-258">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="3c207-259">Quando viene rilevata una corrispondenza e non sono necessarie altre operazioni di elaborazione delle regole, ignorare l'elaborazione delle regole rimanenti.</span><span class="sxs-lookup"><span data-stu-id="3c207-259">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="3c207-260">Modulo Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="3c207-260">Apache mod_rewrite</span></span>

<span data-ttu-id="3c207-261">Applicare le regole del modulo Apache mod_rewrite con <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-261">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="3c207-262">Assicurarsi che il file delle regole venga distribuito con l'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-262">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="3c207-263">Per altre informazioni ed esempi di regole mod_rewrite, vedere [Modulo Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="3c207-263">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="3c207-264"><xref:System.IO.StreamReader>Viene usato per leggere le regole del file di regole *ApacheModRewrite.txt* :</span><span class="sxs-lookup"><span data-stu-id="3c207-264">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="3c207-265">L'app di esempio reindirizza le richieste da `/apache-mod-rules-redirect/(.\*)` a `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-265">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="3c207-266">Il codice di stato della risposta è *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-266">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/3.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="3c207-267">Richiesta originale: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="3c207-267">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="3c207-269">Il middleware supporta le seguenti variabili server del modulo Apache mod_rewrite:</span><span class="sxs-lookup"><span data-stu-id="3c207-269">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="3c207-270">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-270">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-271">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="3c207-271">HTTP_ACCEPT</span></span>
* <span data-ttu-id="3c207-272">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="3c207-272">HTTP_CONNECTION</span></span>
* <span data-ttu-id="3c207-273">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="3c207-273">HTTP_COOKIE</span></span>
* <span data-ttu-id="3c207-274">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="3c207-274">HTTP_FORWARDED</span></span>
* <span data-ttu-id="3c207-275">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="3c207-275">HTTP_HOST</span></span>
* <span data-ttu-id="3c207-276">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="3c207-276">HTTP_REFERER</span></span>
* <span data-ttu-id="3c207-277">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="3c207-277">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="3c207-278">HTTPS</span><span class="sxs-lookup"><span data-stu-id="3c207-278">HTTPS</span></span>
* <span data-ttu-id="3c207-279">IPV6</span><span class="sxs-lookup"><span data-stu-id="3c207-279">IPV6</span></span>
* <span data-ttu-id="3c207-280">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="3c207-280">QUERY_STRING</span></span>
* <span data-ttu-id="3c207-281">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-281">REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-282">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-282">REMOTE_PORT</span></span>
* <span data-ttu-id="3c207-283">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-283">REQUEST_FILENAME</span></span>
* <span data-ttu-id="3c207-284">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="3c207-284">REQUEST_METHOD</span></span>
* <span data-ttu-id="3c207-285">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="3c207-285">REQUEST_SCHEME</span></span>
* <span data-ttu-id="3c207-286">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="3c207-286">REQUEST_URI</span></span>
* <span data-ttu-id="3c207-287">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-287">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="3c207-288">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-288">SERVER_ADDR</span></span>
* <span data-ttu-id="3c207-289">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-289">SERVER_PORT</span></span>
* <span data-ttu-id="3c207-290">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="3c207-290">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="3c207-291">TIME</span><span class="sxs-lookup"><span data-stu-id="3c207-291">TIME</span></span>
* <span data-ttu-id="3c207-292">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="3c207-292">TIME_DAY</span></span>
* <span data-ttu-id="3c207-293">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="3c207-293">TIME_HOUR</span></span>
* <span data-ttu-id="3c207-294">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="3c207-294">TIME_MIN</span></span>
* <span data-ttu-id="3c207-295">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="3c207-295">TIME_MON</span></span>
* <span data-ttu-id="3c207-296">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="3c207-296">TIME_SEC</span></span>
* <span data-ttu-id="3c207-297">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="3c207-297">TIME_WDAY</span></span>
* <span data-ttu-id="3c207-298">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="3c207-298">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="3c207-299">Regole di IIS URL Rewrite Module</span><span class="sxs-lookup"><span data-stu-id="3c207-299">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="3c207-300">Per usare lo stesso set di regole applicabile a IIS URL Rewrite Module, usare <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-300">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="3c207-301">Assicurarsi che il file delle regole venga distribuito con l'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-301">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="3c207-302">Non indirizzare il middleware all'uso del file *web.config* dell'app quando è in esecuzione in Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="3c207-302">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="3c207-303">Con IIS queste regole devono essere archiviate al di fuori del file *web.config* dell'app, per evitare conflitti con il modulo IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="3c207-303">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="3c207-304">Per altre informazioni ed esempi di regole di IIS URL Rewrite Module, vedere [Using URL Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso di URL Rewrite Module 2.0) e [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Guida di riferimento per la configurazione di URL Rewrite Module).</span><span class="sxs-lookup"><span data-stu-id="3c207-304">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="3c207-305"><xref:System.IO.StreamReader>Viene usato per leggere le regole del file di regole *IISUrlRewrite.xml* :</span><span class="sxs-lookup"><span data-stu-id="3c207-305">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="3c207-306">L'app di esempio riscrive le richieste da `/iis-rules-rewrite/(.*)` a `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-306">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="3c207-307">La risposta viene inviata al client con il codice di stato *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="3c207-307">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/3.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="3c207-308">Richiesta originale: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="3c207-308">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richiesta e risposta](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="3c207-310">Se è presente un modulo IIS Rewrite attivo con regole di livello server configurate che possono avere effetti indesiderati nell'app, è possibile disabilitare il modulo IIS Rewrite per un'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-310">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="3c207-311">Per altre informazioni, vedere [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules) (Disabilitazione di moduli IIS).</span><span class="sxs-lookup"><span data-stu-id="3c207-311">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="3c207-312">Funzionalità non supportate</span><span class="sxs-lookup"><span data-stu-id="3c207-312">Unsupported features</span></span>

<span data-ttu-id="3c207-313">Il middleware rilasciato con ASP.NET Core 2.x non supporta le seguenti funzionalità di IIS URL Rewrite Module:</span><span class="sxs-lookup"><span data-stu-id="3c207-313">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="3c207-314">Regole in uscita</span><span class="sxs-lookup"><span data-stu-id="3c207-314">Outbound Rules</span></span>
* <span data-ttu-id="3c207-315">Variabili server personalizzate</span><span class="sxs-lookup"><span data-stu-id="3c207-315">Custom Server Variables</span></span>
* <span data-ttu-id="3c207-316">Caratteri jolly</span><span class="sxs-lookup"><span data-stu-id="3c207-316">Wildcards</span></span>
* <span data-ttu-id="3c207-317">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="3c207-317">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="3c207-318">Variabili server supportate</span><span class="sxs-lookup"><span data-stu-id="3c207-318">Supported server variables</span></span>

<span data-ttu-id="3c207-319">Il middleware supporta le seguenti variabili server di IIS URL Rewrite Module:</span><span class="sxs-lookup"><span data-stu-id="3c207-319">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="3c207-320">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="3c207-320">CONTENT_LENGTH</span></span>
* <span data-ttu-id="3c207-321">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="3c207-321">CONTENT_TYPE</span></span>
* <span data-ttu-id="3c207-322">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="3c207-322">HTTP_ACCEPT</span></span>
* <span data-ttu-id="3c207-323">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="3c207-323">HTTP_CONNECTION</span></span>
* <span data-ttu-id="3c207-324">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="3c207-324">HTTP_COOKIE</span></span>
* <span data-ttu-id="3c207-325">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="3c207-325">HTTP_HOST</span></span>
* <span data-ttu-id="3c207-326">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="3c207-326">HTTP_REFERER</span></span>
* <span data-ttu-id="3c207-327">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="3c207-327">HTTP_URL</span></span>
* <span data-ttu-id="3c207-328">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="3c207-328">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="3c207-329">HTTPS</span><span class="sxs-lookup"><span data-stu-id="3c207-329">HTTPS</span></span>
* <span data-ttu-id="3c207-330">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-330">LOCAL_ADDR</span></span>
* <span data-ttu-id="3c207-331">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="3c207-331">QUERY_STRING</span></span>
* <span data-ttu-id="3c207-332">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-332">REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-333">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-333">REMOTE_PORT</span></span>
* <span data-ttu-id="3c207-334">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-334">REQUEST_FILENAME</span></span>
* <span data-ttu-id="3c207-335">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="3c207-335">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-336">È anche possibile ottenere un <xref:Microsoft.Extensions.FileProviders.IFileProvider> tramite un <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="3c207-336">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="3c207-337">Questo approccio può garantire maggior flessibilità per la posizione dei file delle regole di riscrittura.</span><span class="sxs-lookup"><span data-stu-id="3c207-337">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="3c207-338">Assicurarsi che i file di regole di riscrittura vengano distribuiti nel server in corrispondenza del percorso specificato.</span><span class="sxs-lookup"><span data-stu-id="3c207-338">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="3c207-339">Regola basata su metodo</span><span class="sxs-lookup"><span data-stu-id="3c207-339">Method-based rule</span></span>

<span data-ttu-id="3c207-340">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> per implementare logica della regola personalizzata in un metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="3c207-341">`Add` espone <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, che rende disponibile <xref:Microsoft.AspNetCore.Http.HttpContext> per l'uso nel metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-341">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="3c207-342">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina la modalità di gestione dell'elaborazione pipeline aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="3c207-342">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="3c207-343">Impostare il valore su uno dei campi <xref:Microsoft.AspNetCore.Rewrite.RuleResult> descritti nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="3c207-343">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| <span data-ttu-id="3c207-344">Riscrivi risultato contesto</span><span class="sxs-lookup"><span data-stu-id="3c207-344">Rewrite context result</span></span>               | <span data-ttu-id="3c207-345">Azione</span><span class="sxs-lookup"><span data-stu-id="3c207-345">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="3c207-346">`RuleResult.ContinueRules` (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="3c207-346">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="3c207-347">Continuare ad applicare le regole.</span><span class="sxs-lookup"><span data-stu-id="3c207-347">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="3c207-348">Interrompere l'applicazione delle regole e inviare la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-348">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="3c207-349">Interrompere l'applicazione delle regole e inviare il contesto al middleware successivo.</span><span class="sxs-lookup"><span data-stu-id="3c207-349">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="3c207-350">L'app di esempio visualizza un metodo che reindirizza le richieste per i percorsi che terminano con *.xml*.</span><span class="sxs-lookup"><span data-stu-id="3c207-350">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="3c207-351">Se viene inviata una richiesta per `/file.xml`, la richiesta viene reindirizzata a `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="3c207-351">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="3c207-352">Il codice di stato viene impostato su *301 - Spostato permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="3c207-352">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="3c207-353">Quando il browser invia una nuova richiesta per */xmlfiles/file.xml*, il middleware dei file statici rende disponibile il file al client dalla cartella *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="3c207-353">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="3c207-354">Per un reindirizzamento, impostare in modo esplicito il codice di stato della risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-354">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="3c207-355">In caso contrario, viene restituito il codice di stato *200 - OK* e il reindirizzamento non viene eseguito nel client.</span><span class="sxs-lookup"><span data-stu-id="3c207-355">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="3c207-356">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="3c207-356">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="3c207-357">Questo approccio consente anche di riscrivere le richieste.</span><span class="sxs-lookup"><span data-stu-id="3c207-357">This approach can also rewrite requests.</span></span> <span data-ttu-id="3c207-358">L'app di esempio illustra la riscrittura del percorso di una richiesta di file di testo per rendere disponibile il file di testo *file. txt* dalla cartella *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="3c207-358">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="3c207-359">Il middleware dei file statici rende disponibile il file in base al percorso di richiesta aggiornato:</span><span class="sxs-lookup"><span data-stu-id="3c207-359">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="3c207-360">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="3c207-360">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="3c207-361">Regola basata su IRule</span><span class="sxs-lookup"><span data-stu-id="3c207-361">IRule-based rule</span></span>

<span data-ttu-id="3c207-362">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> per usare la logica della regola in una classe che implementa l'interfaccia <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="3c207-362">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="3c207-363">`IRule` garantisce maggiore flessibilità rispetto all'approccio con una regola basata su un metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-363">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="3c207-364">La classe di implementazione può includere un costruttore, che consente di passare parametri per il metodo <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-364">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="3c207-365">I valori dei parametri nell'app di esempio per `extension` e `newPath` vengono verificati e devono soddisfare diverse condizioni.</span><span class="sxs-lookup"><span data-stu-id="3c207-365">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="3c207-366">`extension` deve contenere un valore e tale valore deve essere *.png*, *.jpg* o *.gif*.</span><span class="sxs-lookup"><span data-stu-id="3c207-366">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="3c207-367">Se `newPath` non è valido, viene generato un evento <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="3c207-367">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="3c207-368">Se viene inviata una richiesta per *image.png*, la richiesta viene reindirizzata a `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="3c207-368">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="3c207-369">Se viene inviata una richiesta per *image.jpg*, la richiesta viene reindirizzata a `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="3c207-369">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="3c207-370">Il codice di stato viene impostato su *301 - Spostato permanentemente* e l'elemento `context.Result` viene impostato per l'interruzione dell'elaborazione delle regole e l'invio della risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-370">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="3c207-371">Richiesta originale: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="3c207-371">Original Request: `/image.png`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte per image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="3c207-373">Richiesta originale: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="3c207-373">Original Request: `/image.jpg`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte per image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="3c207-375">Esempi di espressioni regolari</span><span class="sxs-lookup"><span data-stu-id="3c207-375">Regex examples</span></span>

| <span data-ttu-id="3c207-376">Obiettivo</span><span class="sxs-lookup"><span data-stu-id="3c207-376">Goal</span></span> | <span data-ttu-id="3c207-377">Esempio di stringa espressione regolare</span><span class="sxs-lookup"><span data-stu-id="3c207-377">Regex String &</span></span><br><span data-ttu-id="3c207-378">e corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-378">Match Example</span></span> | <span data-ttu-id="3c207-379">Esempio di stringa di sostituzione</span><span class="sxs-lookup"><span data-stu-id="3c207-379">Replacement String &</span></span><br><span data-ttu-id="3c207-380">e output</span><span class="sxs-lookup"><span data-stu-id="3c207-380">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="3c207-381">Riscrivere il percorso nella stringa di query</span><span class="sxs-lookup"><span data-stu-id="3c207-381">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="3c207-382">Rimuovere la barra finale</span><span class="sxs-lookup"><span data-stu-id="3c207-382">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="3c207-383">Applicare la barra finale</span><span class="sxs-lookup"><span data-stu-id="3c207-383">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="3c207-384">Evitare la riscrittura di richieste specifiche</span><span class="sxs-lookup"><span data-stu-id="3c207-384">Avoid rewriting specific requests</span></span> | <span data-ttu-id="3c207-385">`^(.*)(?<!\.axd)$` o `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="3c207-385">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="3c207-386">Sì: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="3c207-386">Yes: `/resource.htm`</span></span><br><span data-ttu-id="3c207-387">No: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="3c207-387">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="3c207-388">Ridisporre i segmenti di URL</span><span class="sxs-lookup"><span data-stu-id="3c207-388">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="3c207-389">Sostituire un segmento di URL</span><span class="sxs-lookup"><span data-stu-id="3c207-389">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="3c207-390">Questo documento presenta la riscrittura URL con istruzioni per l'uso del middleware Riscrittura URL nelle applicazioni ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="3c207-390">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="3c207-391">La riscrittura URL è l'azione di modificare gli URL di richiesta in base a una o più regole predefinite.</span><span class="sxs-lookup"><span data-stu-id="3c207-391">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="3c207-392">Il processo di riscrittura URL crea un'astrazione tra i percorsi delle risorse e i relativi indirizzi, in modo che i percorsi e gli indirizzi non risultino strettamente collegati.</span><span class="sxs-lookup"><span data-stu-id="3c207-392">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="3c207-393">La riscrittura URL risulta utile in diversi scenari per:</span><span class="sxs-lookup"><span data-stu-id="3c207-393">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="3c207-394">Spostare o sostituire in modo temporaneo o permanente risorse server mantenendo localizzatori stabili di queste risorse.</span><span class="sxs-lookup"><span data-stu-id="3c207-394">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="3c207-395">Suddividere l'elaborazione delle richieste tra app diverse o tra aree diverse di un'unica app.</span><span class="sxs-lookup"><span data-stu-id="3c207-395">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="3c207-396">Rimuovere, aggiungere o riorganizzare segmenti URL nelle richieste in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-396">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="3c207-397">Ottimizzare gli URL pubblici per l'ottimizzazione motore di ricerca (SEO, Search Engine Optimization).</span><span class="sxs-lookup"><span data-stu-id="3c207-397">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="3c207-398">Consentire l'uso di URL pubblici descrittivi in modo che i visitatori possano prevedere il contenuto restituito dalla richiesta di una risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-398">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="3c207-399">Reindirizzare le richieste non protette a endpoint protetti.</span><span class="sxs-lookup"><span data-stu-id="3c207-399">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="3c207-400">Evitare l'hotlinking, ovvero l'uso da parte di un sito esterno di una risorsa statica ospitata presente in un altro sito tramite il collegamento di questa al proprio contenuto.</span><span class="sxs-lookup"><span data-stu-id="3c207-400">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-401">La riscrittura URL può ridurre le prestazioni di un'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-401">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="3c207-402">Ove possibile, limitare il numero e la complessità delle regole.</span><span class="sxs-lookup"><span data-stu-id="3c207-402">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="3c207-403">[Visualizzare o scaricare il codice di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="3c207-403">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="3c207-404">Reindirizzamento URL e riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-404">URL redirect and URL rewrite</span></span>

<span data-ttu-id="3c207-405">La differenza tra i termini *reindirizzamento URL* e *riscrittura URL* è minima, ma ha implicazioni importanti nell'offerta di risorse ai clienti.</span><span class="sxs-lookup"><span data-stu-id="3c207-405">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="3c207-406">Il middleware Riscrittura URL di ASP.NET Core è in grado di svolgere entrambe le funzioni.</span><span class="sxs-lookup"><span data-stu-id="3c207-406">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="3c207-407">Un *reindirizzamento URL* implica un'operazione lato client, in cui viene richiesto al client di accedere a una risorsa a un indirizzo diverso da quello richiesto originariamente dal client.</span><span class="sxs-lookup"><span data-stu-id="3c207-407">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="3c207-408">Questa operazione richiede un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-408">This requires a round trip to the server.</span></span> <span data-ttu-id="3c207-409">L'URL di reindirizzamento restituito al client viene visualizzato nella barra degli indirizzi del browser quando il client effettua una nuova richiesta per la risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-409">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="3c207-410">In caso di *reindirizzamento* di `/resource` a `/different-resource`, il server risponde che il client deve ottenere la risorsa presso `/different-resource` con un codice di stato che indica se il reindirizzamento è temporaneo o permanente.</span><span class="sxs-lookup"><span data-stu-id="3c207-410">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Un endpoint di servizio WebAPI è stato modificato temporaneamente dalla versione 1 (v1) alla versione 2 (v2) nel server.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="3c207-416">Quando si reindirizzano le richieste a un URL diverso, indicare se il reindirizzamento è temporaneo o permanente specificando il codice di stato con la risposta:</span><span class="sxs-lookup"><span data-stu-id="3c207-416">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="3c207-417">Il codice di stato *301 - Spostato permanentemente* viene usato se la risorsa ha un nuovo URL definitivo e si vuole indicare al client che tale URL dovrà essere usato per tutte le richieste future della risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-417">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="3c207-418">*Quando riceve un codice di stato 301, il client può memorizzare la risposta nella cache e riusarla.*</span><span class="sxs-lookup"><span data-stu-id="3c207-418">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="3c207-419">Il codice di stato *302 - Trovato* viene usato quando il reindirizzamento è temporaneo o comunque soggetto a modifiche.</span><span class="sxs-lookup"><span data-stu-id="3c207-419">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="3c207-420">Il codice di stato 302 indica che il client non dovrà archiviare e riusare l'URL di reindirizzamento in futuro.</span><span class="sxs-lookup"><span data-stu-id="3c207-420">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="3c207-421">Per altre informazioni sui codici di stato, vedere [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) (RFC 2616: Definizioni dei codici di stato).</span><span class="sxs-lookup"><span data-stu-id="3c207-421">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="3c207-422">La *riscrittura URL* è un'operazione lato server che rende disponibile una risorsa da un indirizzo diverso da quello richiesto dal client.</span><span class="sxs-lookup"><span data-stu-id="3c207-422">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="3c207-423">La riscrittura URL non richiede un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-423">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="3c207-424">L'URL riscritto non viene restituito al client e non viene visualizzato nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="3c207-424">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="3c207-425">Se `/resource` viene *riscritto* in `/different-resource`, il server recupera *internamente* la risorsa in `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="3c207-425">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="3c207-426">Anche se il client fosse in grado di recuperare la risorsa nell'URL riscritto, non viene informato dell'esistenza della risorsa nell'URL riscritto quando effettua la richiesta e riceve la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-426">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Un endpoint servizio WebAPI è stato modificato dalla versione 1 (v1) alla versione 2 (v2) sul server.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="3c207-431">App di esempio per la riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-431">URL rewriting sample app</span></span>

<span data-ttu-id="3c207-432">È possibile esplorare le funzionalità del middleware Riscrittura URL con l'[app di esempio](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="3c207-432">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="3c207-433">L'app applica regole di reindirizzamento e riscrittura e visualizza l'URL reindirizzato o riscritto per diversi scenari.</span><span class="sxs-lookup"><span data-stu-id="3c207-433">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="3c207-434">Quando usare il middleware Riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-434">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="3c207-435">Usare il middleware Riscrittura URL quando non è possibile usare gli approcci seguenti:</span><span class="sxs-lookup"><span data-stu-id="3c207-435">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="3c207-436">URL Rewrite Module for IIS in Windows Server</span><span class="sxs-lookup"><span data-stu-id="3c207-436">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="3c207-437">Modulo Apache mod_rewrite in Apache Server</span><span class="sxs-lookup"><span data-stu-id="3c207-437">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="3c207-438">Riscrittura URL in Nginx</span><span class="sxs-lookup"><span data-stu-id="3c207-438">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="3c207-439">Usare il middleware anche se l'app è ospitata in un [server HTTP.sys](xref:fundamentals/servers/httpsys) (in precedenza denominato WebListener).</span><span class="sxs-lookup"><span data-stu-id="3c207-439">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="3c207-440">I motivi principali per usare tecnologie di riscrittura URL basate su server in IIS, Apache e Nginx sono:</span><span class="sxs-lookup"><span data-stu-id="3c207-440">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="3c207-441">Il middleware non supporta tutte le funzionalità di questi moduli.</span><span class="sxs-lookup"><span data-stu-id="3c207-441">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="3c207-442">Alcune funzionalità dei moduli server non funzionano con i progetti ASP.NET Core, ad esempio i vincoli `IsFile` e `IsDirectory` del modulo IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="3c207-442">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="3c207-443">In questi scenari è necessario usare il middleware.</span><span class="sxs-lookup"><span data-stu-id="3c207-443">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="3c207-444">Le prestazioni del middleware probabilmente non corrispondono a quelle dei moduli.</span><span class="sxs-lookup"><span data-stu-id="3c207-444">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="3c207-445">Il benchmarking rappresenta l'unico modo per sapere con certezza quale approccio comporta la maggior riduzione delle prestazioni o se tale riduzione è trascurabile.</span><span class="sxs-lookup"><span data-stu-id="3c207-445">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="3c207-446">Pacchetto</span><span class="sxs-lookup"><span data-stu-id="3c207-446">Package</span></span>

<span data-ttu-id="3c207-447">Per includere il middleware nel progetto, aggiungere un riferimento al pacchetto al [metapacchetto Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) nel file di progetto, che contiene il pacchetto [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite).</span><span class="sxs-lookup"><span data-stu-id="3c207-447">To include the middleware in your project, add a package reference to the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the project file, which contains the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package.</span></span>

<span data-ttu-id="3c207-448">Se non si usa il metapacchetto `Microsoft.AspNetCore.App`, aggiungere un riferimento al progetto al pacchetto `Microsoft.AspNetCore.Rewrite`.</span><span class="sxs-lookup"><span data-stu-id="3c207-448">When not using the `Microsoft.AspNetCore.App` metapackage, add a project reference to the `Microsoft.AspNetCore.Rewrite` package.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="3c207-449">Estensioni e opzioni</span><span class="sxs-lookup"><span data-stu-id="3c207-449">Extension and options</span></span>

<span data-ttu-id="3c207-450">È possibile definire regole di riscrittura e reindirizzamento URL creando un'istanza della classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) con metodi di estensione per le singole regole di riscrittura.</span><span class="sxs-lookup"><span data-stu-id="3c207-450">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="3c207-451">Concatenare più regole nell'ordine in cui si vuole che vengano elaborate.</span><span class="sxs-lookup"><span data-stu-id="3c207-451">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="3c207-452">Le opzioni `RewriteOptions` vengono passate al middleware Riscrittura URL quando questo viene aggiunto alla pipeline della richiesta con <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="3c207-452">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="3c207-453">Reindirizzare non-www su www</span><span class="sxs-lookup"><span data-stu-id="3c207-453">Redirect non-www to www</span></span>

<span data-ttu-id="3c207-454">Sono disponibili tre opzioni che consentono all'app di reindirizzare richieste non-`www` su `www`:</span><span class="sxs-lookup"><span data-stu-id="3c207-454">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="3c207-455"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>: Reindirizza in modo permanente la richiesta al `www` sottodominio se la richiesta è non `www` .</span><span class="sxs-lookup"><span data-stu-id="3c207-455"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>: Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="3c207-456">Reindirizza con un codice di stato [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="3c207-456">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="3c207-457"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>: Reindirizza la richiesta al `www` sottodominio se la richiesta in ingresso è non `www` .</span><span class="sxs-lookup"><span data-stu-id="3c207-457"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>: Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="3c207-458">Reindirizza con un codice di stato [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="3c207-458">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="3c207-459">Un overload consente di specificare il codice di stato per la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-459">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="3c207-460">Usare un campo della classe <xref:Microsoft.AspNetCore.Http.StatusCodes> per un'assegnazione di codice di stato.</span><span class="sxs-lookup"><span data-stu-id="3c207-460">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="3c207-461">Reindirizzamento URL</span><span class="sxs-lookup"><span data-stu-id="3c207-461">URL redirect</span></span>

<span data-ttu-id="3c207-462">Per reindirizzare le richieste, usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-462">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="3c207-463">Il primo parametro contiene l'espressione regolare per la corrispondenza in base al percorso dell'URL in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-463">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="3c207-464">Il secondo parametro è la stringa di sostituzione.</span><span class="sxs-lookup"><span data-stu-id="3c207-464">The second parameter is the replacement string.</span></span> <span data-ttu-id="3c207-465">Il terzo parametro, se presente, specifica il codice di stato.</span><span class="sxs-lookup"><span data-stu-id="3c207-465">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="3c207-466">Se il codice di stato non è specificato, assume come valore predefinito *302 - Trovato*, che indica che la risorsa è stata temporaneamente spostata o sostituita.</span><span class="sxs-lookup"><span data-stu-id="3c207-466">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="3c207-467">In un browser con gli strumenti di sviluppo abilitati, creare una richiesta all'app di esempio con il percorso `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-467">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="3c207-468">L'espressione regolare definisce la corrispondenza con il percorso di richiesta in `redirect-rule/(.*)` e il percorso viene sostituito con `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-468">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="3c207-469">L'URL di reindirizzamento viene restituito al client con il codice di stato *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-469">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="3c207-470">Il browser invia una nuova richiesta all'URL di reindirizzamento, che viene visualizzata nella barra degli indirizzi del browser.</span><span class="sxs-lookup"><span data-stu-id="3c207-470">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="3c207-471">Poiché nessuna regola nell'app di esempio corrisponde all'URL di reindirizzamento:</span><span class="sxs-lookup"><span data-stu-id="3c207-471">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="3c207-472">La seconda richiesta riceve una risposta *200 - OK* dall'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-472">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="3c207-473">Il corpo della risposta visualizza l'URL di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-473">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="3c207-474">Quando un URL viene *reindirizzato*, viene eseguito un round trip al server.</span><span class="sxs-lookup"><span data-stu-id="3c207-474">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="3c207-475">Prestare attenzione quando si definiscono regole di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-475">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="3c207-476">Le regole di reindirizzamento vengono valutate in ogni richiesta all'app, anche dopo un reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="3c207-476">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="3c207-477">È facile creare inavvertitamente un *ciclo di reindirizzamento infinito*.</span><span class="sxs-lookup"><span data-stu-id="3c207-477">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="3c207-478">Richiesta originale: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="3c207-478">Original Request: `/redirect-rule/1234/5678`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="3c207-480">La parte dell'espressione racchiusa tra parentesi è denominata *gruppo Capture*.</span><span class="sxs-lookup"><span data-stu-id="3c207-480">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="3c207-481">Il punto (`.`) dell'espressione significa *corrispondenza con qualsiasi carattere*.</span><span class="sxs-lookup"><span data-stu-id="3c207-481">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="3c207-482">L'asterisco (`*`) indica *corrispondenza con il carattere precedente per zero o più volte*.</span><span class="sxs-lookup"><span data-stu-id="3c207-482">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="3c207-483">Di conseguenza gli ultimi due i segmenti di percorso dell'URL `1234/5678` vengono acquisiti tramite il gruppo Capture `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="3c207-483">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="3c207-484">Qualsiasi valore visualizzato nell'URL della richiesta dopo `redirect-rule/` viene acquisito da questo gruppo Capture.</span><span class="sxs-lookup"><span data-stu-id="3c207-484">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="3c207-485">Nella stringa di sostituzione i gruppi acquisiti vengono inseriti nella stringa con il simbolo di dollaro (`$`) seguito dal numero di sequenza dell'acquisizione.</span><span class="sxs-lookup"><span data-stu-id="3c207-485">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="3c207-486">Il primo valore del gruppo Capture viene ottenuto con `$1`, il secondo con `$2` e la procedura continua in sequenza per i gruppi Capture presenti nell'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="3c207-486">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="3c207-487">Nell'espressione regolare della regola di reindirizzamento dell'app di esempio è presente un solo gruppo acquisito, pertanto nella stringa di sostituzione è presente un solo gruppo inserito, ovvero `$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-487">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="3c207-488">Quando viene applicata la regola, l'URL diventa `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-488">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="3c207-489">Reindirizzamento URL a un endpoint protetto</span><span class="sxs-lookup"><span data-stu-id="3c207-489">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="3c207-490">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> per reindirizzare le richieste HTTP allo stesso host e allo stesso percorso tramite il protocollo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3c207-490">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="3c207-491">Se il codice di stato non viene specificato, il middleware usa come valore predefinito *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-491">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="3c207-492">Se non viene specificata la porta:</span><span class="sxs-lookup"><span data-stu-id="3c207-492">If the port isn't supplied:</span></span>

* <span data-ttu-id="3c207-493">Il middleware usa come valore predefinito `null`.</span><span class="sxs-lookup"><span data-stu-id="3c207-493">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="3c207-494">Lo schema viene modificato in `https` (protocollo HTTPS) e il client accede alla risorsa attraverso la porta 443.</span><span class="sxs-lookup"><span data-stu-id="3c207-494">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="3c207-495">L'esempio seguente illustra come impostare il codice di stato su *301 - Spostato permanentemente* e come passare alla porta 5001.</span><span class="sxs-lookup"><span data-stu-id="3c207-495">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="3c207-496">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> per reindirizzare le richieste non protette allo stesso host e allo stesso percorso con il protocollo protetto HTTPS attraverso la porta 443.</span><span class="sxs-lookup"><span data-stu-id="3c207-496">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="3c207-497">Il middleware imposta il codice di stato su *301 - Spostato permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="3c207-497">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="3c207-498">Per il reindirizzamento a un endpoint protetto quando non sono richieste regole di reindirizzamento aggiuntive, è consigliabile usare il middleware di reindirizzamento HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3c207-498">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="3c207-499">Per altre informazioni, vedere l'argomento [Imporre HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="3c207-499">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="3c207-500">L'app di esempio indica come usare `AddRedirectToHttps` o `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="3c207-500">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="3c207-501">Aggiungere il metodo di estensione a `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="3c207-501">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="3c207-502">Eseguire una richiesta non sicura all'app su qualsiasi URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-502">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="3c207-503">Ignorare l'avviso di sicurezza del browser indicante che il certificato autofirmato non è attendibile oppure creare un'eccezione per rendere affidabile il certificato.</span><span class="sxs-lookup"><span data-stu-id="3c207-503">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="3c207-504">Richiesta originale con `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="3c207-504">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="3c207-506">Richiesta originale con `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="3c207-506">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="3c207-508">Riscrittura URL</span><span class="sxs-lookup"><span data-stu-id="3c207-508">URL rewrite</span></span>

<span data-ttu-id="3c207-509">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> per creare una regola di riscrittura URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-509">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="3c207-510">Il primo parametro contiene l'espressione regolare per la corrispondenza in base al percorso dell'URL in ingresso.</span><span class="sxs-lookup"><span data-stu-id="3c207-510">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="3c207-511">Il secondo parametro è la stringa di sostituzione.</span><span class="sxs-lookup"><span data-stu-id="3c207-511">The second parameter is the replacement string.</span></span> <span data-ttu-id="3c207-512">Il terzo parametro, `skipRemainingRules: {true|false}`, indica al middleware se ignorare le regole di riscrittura aggiuntive quando viene applicata la regola corrente.</span><span class="sxs-lookup"><span data-stu-id="3c207-512">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="3c207-513">Richiesta originale: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="3c207-513">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richiesta e risposta](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="3c207-515">L'accento circonflesso (`^`) all'inizio dell'espressione indica che la corrispondenza inizia all'inizio del percorso dell'URL.</span><span class="sxs-lookup"><span data-stu-id="3c207-515">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="3c207-516">Nell'esempio precedente della regola di reindirizzamento `redirect-rule/(.*)`, non è presente l'accento circonflesso (`^`) all'inizio dell'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="3c207-516">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="3c207-517">È quindi possibile ottenere una corrispondenza anteponendo qualsiasi carattere a `redirect-rule/`.</span><span class="sxs-lookup"><span data-stu-id="3c207-517">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="3c207-518">Percorso</span><span class="sxs-lookup"><span data-stu-id="3c207-518">Path</span></span>                               | <span data-ttu-id="3c207-519">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-519">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="3c207-520">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-520">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="3c207-521">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-521">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="3c207-522">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-522">Yes</span></span>   |

<span data-ttu-id="3c207-523">La regola di riscrittura, `^rewrite-rule/(\d+)/(\d+)`, rileva la corrispondenza dei percorsi solo se iniziano con `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="3c207-523">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="3c207-524">Nella tabella seguente, si noti la differenza nella corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="3c207-524">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="3c207-525">Percorso</span><span class="sxs-lookup"><span data-stu-id="3c207-525">Path</span></span>                              | <span data-ttu-id="3c207-526">Corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-526">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="3c207-527">Sì</span><span class="sxs-lookup"><span data-stu-id="3c207-527">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="3c207-528">No</span><span class="sxs-lookup"><span data-stu-id="3c207-528">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="3c207-529">No</span><span class="sxs-lookup"><span data-stu-id="3c207-529">No</span></span>    |

<span data-ttu-id="3c207-530">Dopo la parte `^rewrite-rule/` dell'espressione sono presenti due gruppi Capture, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="3c207-530">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="3c207-531">`\d` indica *corrispondenza con una cifra (numero)*.</span><span class="sxs-lookup"><span data-stu-id="3c207-531">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="3c207-532">Il segno più (`+`) indica *corrispondenza con uno o più dei caratteri precedenti*.</span><span class="sxs-lookup"><span data-stu-id="3c207-532">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="3c207-533">Di conseguenza l'URL deve contenere un numero seguito da una barra seguita a sua volta da un altro numero.</span><span class="sxs-lookup"><span data-stu-id="3c207-533">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="3c207-534">Questi gruppi Capture vengono inseriti nell'URL riscritto come `$1` e `$2`.</span><span class="sxs-lookup"><span data-stu-id="3c207-534">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="3c207-535">La stringa di sostituzione della regola di riscrittura inserisce i gruppi acquisiti nella stringa di query.</span><span class="sxs-lookup"><span data-stu-id="3c207-535">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="3c207-536">Il percorso richiesto `/rewrite-rule/1234/5678` viene riscritto per ottenere la risorsa in `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="3c207-536">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="3c207-537">Se nella richiesta originale è presente una stringa di query, la stringa viene mantenuta quando l'URL viene riscritto.</span><span class="sxs-lookup"><span data-stu-id="3c207-537">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="3c207-538">Non viene eseguito alcun round trip al server per ottenere la risorsa.</span><span class="sxs-lookup"><span data-stu-id="3c207-538">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="3c207-539">Se la risorsa esiste, viene recuperata e restituita al client con il codice di stato *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="3c207-539">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="3c207-540">Poiché il client non è reindirizzato, l'URL nella barra degli indirizzi del browser non cambia.</span><span class="sxs-lookup"><span data-stu-id="3c207-540">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="3c207-541">I client non sono in grado di rilevare che si è verificata un'operazione di riscrittura URL nel server.</span><span class="sxs-lookup"><span data-stu-id="3c207-541">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-542">Se possibile, usare sempre `skipRemainingRules: true`, perché la corrispondenza tra le regole è onerosa dal punto di vista del calcolo e aumenta il tempo di risposta dell'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-542">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="3c207-543">Per velocizzare il tempo di risposta dell'app:</span><span class="sxs-lookup"><span data-stu-id="3c207-543">For the fastest app response:</span></span>
>
> * <span data-ttu-id="3c207-544">Ordinare le regole di riscrittura dalla regola che origina più corrispondenze a quella che origina meno corrispondenze.</span><span class="sxs-lookup"><span data-stu-id="3c207-544">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="3c207-545">Quando viene rilevata una corrispondenza e non sono necessarie altre operazioni di elaborazione delle regole, ignorare l'elaborazione delle regole rimanenti.</span><span class="sxs-lookup"><span data-stu-id="3c207-545">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="3c207-546">Modulo Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="3c207-546">Apache mod_rewrite</span></span>

<span data-ttu-id="3c207-547">Applicare le regole del modulo Apache mod_rewrite con <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-547">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="3c207-548">Assicurarsi che il file delle regole venga distribuito con l'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-548">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="3c207-549">Per altre informazioni ed esempi di regole mod_rewrite, vedere [Modulo Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="3c207-549">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="3c207-550"><xref:System.IO.StreamReader>Viene usato per leggere le regole del file di regole *ApacheModRewrite.txt* :</span><span class="sxs-lookup"><span data-stu-id="3c207-550">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="3c207-551">L'app di esempio reindirizza le richieste da `/apache-mod-rules-redirect/(.\*)` a `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-551">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="3c207-552">Il codice di stato della risposta è *302 - Trovato*.</span><span class="sxs-lookup"><span data-stu-id="3c207-552">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/2.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="3c207-553">Richiesta originale: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="3c207-553">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="3c207-555">Il middleware supporta le seguenti variabili server del modulo Apache mod_rewrite:</span><span class="sxs-lookup"><span data-stu-id="3c207-555">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="3c207-556">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-556">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-557">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="3c207-557">HTTP_ACCEPT</span></span>
* <span data-ttu-id="3c207-558">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="3c207-558">HTTP_CONNECTION</span></span>
* <span data-ttu-id="3c207-559">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="3c207-559">HTTP_COOKIE</span></span>
* <span data-ttu-id="3c207-560">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="3c207-560">HTTP_FORWARDED</span></span>
* <span data-ttu-id="3c207-561">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="3c207-561">HTTP_HOST</span></span>
* <span data-ttu-id="3c207-562">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="3c207-562">HTTP_REFERER</span></span>
* <span data-ttu-id="3c207-563">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="3c207-563">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="3c207-564">HTTPS</span><span class="sxs-lookup"><span data-stu-id="3c207-564">HTTPS</span></span>
* <span data-ttu-id="3c207-565">IPV6</span><span class="sxs-lookup"><span data-stu-id="3c207-565">IPV6</span></span>
* <span data-ttu-id="3c207-566">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="3c207-566">QUERY_STRING</span></span>
* <span data-ttu-id="3c207-567">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-567">REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-568">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-568">REMOTE_PORT</span></span>
* <span data-ttu-id="3c207-569">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-569">REQUEST_FILENAME</span></span>
* <span data-ttu-id="3c207-570">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="3c207-570">REQUEST_METHOD</span></span>
* <span data-ttu-id="3c207-571">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="3c207-571">REQUEST_SCHEME</span></span>
* <span data-ttu-id="3c207-572">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="3c207-572">REQUEST_URI</span></span>
* <span data-ttu-id="3c207-573">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-573">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="3c207-574">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-574">SERVER_ADDR</span></span>
* <span data-ttu-id="3c207-575">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-575">SERVER_PORT</span></span>
* <span data-ttu-id="3c207-576">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="3c207-576">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="3c207-577">TIME</span><span class="sxs-lookup"><span data-stu-id="3c207-577">TIME</span></span>
* <span data-ttu-id="3c207-578">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="3c207-578">TIME_DAY</span></span>
* <span data-ttu-id="3c207-579">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="3c207-579">TIME_HOUR</span></span>
* <span data-ttu-id="3c207-580">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="3c207-580">TIME_MIN</span></span>
* <span data-ttu-id="3c207-581">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="3c207-581">TIME_MON</span></span>
* <span data-ttu-id="3c207-582">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="3c207-582">TIME_SEC</span></span>
* <span data-ttu-id="3c207-583">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="3c207-583">TIME_WDAY</span></span>
* <span data-ttu-id="3c207-584">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="3c207-584">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="3c207-585">Regole di IIS URL Rewrite Module</span><span class="sxs-lookup"><span data-stu-id="3c207-585">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="3c207-586">Per usare lo stesso set di regole applicabile a IIS URL Rewrite Module, usare <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-586">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="3c207-587">Assicurarsi che il file delle regole venga distribuito con l'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-587">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="3c207-588">Non indirizzare il middleware all'uso del file *web.config* dell'app quando è in esecuzione in Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="3c207-588">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="3c207-589">Con IIS queste regole devono essere archiviate al di fuori del file *web.config* dell'app, per evitare conflitti con il modulo IIS Rewrite.</span><span class="sxs-lookup"><span data-stu-id="3c207-589">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="3c207-590">Per altre informazioni ed esempi di regole di IIS URL Rewrite Module, vedere [Using URL Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso di URL Rewrite Module 2.0) e [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Guida di riferimento per la configurazione di URL Rewrite Module).</span><span class="sxs-lookup"><span data-stu-id="3c207-590">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="3c207-591"><xref:System.IO.StreamReader>Viene usato per leggere le regole del file di regole *IISUrlRewrite.xml* :</span><span class="sxs-lookup"><span data-stu-id="3c207-591">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="3c207-592">L'app di esempio riscrive le richieste da `/iis-rules-rewrite/(.*)` a `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="3c207-592">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="3c207-593">La risposta viene inviata al client con il codice di stato *200 - OK*.</span><span class="sxs-lookup"><span data-stu-id="3c207-593">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/2.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="3c207-594">Richiesta originale: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="3c207-594">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richiesta e risposta](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="3c207-596">Se è presente un modulo IIS Rewrite attivo con regole di livello server configurate che possono avere effetti indesiderati nell'app, è possibile disabilitare il modulo IIS Rewrite per un'app.</span><span class="sxs-lookup"><span data-stu-id="3c207-596">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="3c207-597">Per altre informazioni, vedere [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules) (Disabilitazione di moduli IIS).</span><span class="sxs-lookup"><span data-stu-id="3c207-597">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="3c207-598">Funzionalità non supportate</span><span class="sxs-lookup"><span data-stu-id="3c207-598">Unsupported features</span></span>

<span data-ttu-id="3c207-599">Il middleware rilasciato con ASP.NET Core 2.x non supporta le seguenti funzionalità di IIS URL Rewrite Module:</span><span class="sxs-lookup"><span data-stu-id="3c207-599">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="3c207-600">Regole in uscita</span><span class="sxs-lookup"><span data-stu-id="3c207-600">Outbound Rules</span></span>
* <span data-ttu-id="3c207-601">Variabili server personalizzate</span><span class="sxs-lookup"><span data-stu-id="3c207-601">Custom Server Variables</span></span>
* <span data-ttu-id="3c207-602">Caratteri jolly</span><span class="sxs-lookup"><span data-stu-id="3c207-602">Wildcards</span></span>
* <span data-ttu-id="3c207-603">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="3c207-603">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="3c207-604">Variabili server supportate</span><span class="sxs-lookup"><span data-stu-id="3c207-604">Supported server variables</span></span>

<span data-ttu-id="3c207-605">Il middleware supporta le seguenti variabili server di IIS URL Rewrite Module:</span><span class="sxs-lookup"><span data-stu-id="3c207-605">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="3c207-606">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="3c207-606">CONTENT_LENGTH</span></span>
* <span data-ttu-id="3c207-607">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="3c207-607">CONTENT_TYPE</span></span>
* <span data-ttu-id="3c207-608">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="3c207-608">HTTP_ACCEPT</span></span>
* <span data-ttu-id="3c207-609">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="3c207-609">HTTP_CONNECTION</span></span>
* <span data-ttu-id="3c207-610">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="3c207-610">HTTP_COOKIE</span></span>
* <span data-ttu-id="3c207-611">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="3c207-611">HTTP_HOST</span></span>
* <span data-ttu-id="3c207-612">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="3c207-612">HTTP_REFERER</span></span>
* <span data-ttu-id="3c207-613">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="3c207-613">HTTP_URL</span></span>
* <span data-ttu-id="3c207-614">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="3c207-614">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="3c207-615">HTTPS</span><span class="sxs-lookup"><span data-stu-id="3c207-615">HTTPS</span></span>
* <span data-ttu-id="3c207-616">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-616">LOCAL_ADDR</span></span>
* <span data-ttu-id="3c207-617">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="3c207-617">QUERY_STRING</span></span>
* <span data-ttu-id="3c207-618">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="3c207-618">REMOTE_ADDR</span></span>
* <span data-ttu-id="3c207-619">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="3c207-619">REMOTE_PORT</span></span>
* <span data-ttu-id="3c207-620">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="3c207-620">REQUEST_FILENAME</span></span>
* <span data-ttu-id="3c207-621">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="3c207-621">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="3c207-622">È anche possibile ottenere un <xref:Microsoft.Extensions.FileProviders.IFileProvider> tramite un <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="3c207-622">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="3c207-623">Questo approccio può garantire maggior flessibilità per la posizione dei file delle regole di riscrittura.</span><span class="sxs-lookup"><span data-stu-id="3c207-623">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="3c207-624">Assicurarsi che i file di regole di riscrittura vengano distribuiti nel server in corrispondenza del percorso specificato.</span><span class="sxs-lookup"><span data-stu-id="3c207-624">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="3c207-625">Regola basata su metodo</span><span class="sxs-lookup"><span data-stu-id="3c207-625">Method-based rule</span></span>

<span data-ttu-id="3c207-626">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> per implementare logica della regola personalizzata in un metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-626">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="3c207-627">`Add` espone <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, che rende disponibile <xref:Microsoft.AspNetCore.Http.HttpContext> per l'uso nel metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-627">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="3c207-628">[RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina la modalità di gestione dell'elaborazione pipeline aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="3c207-628">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="3c207-629">Impostare il valore su uno dei campi <xref:Microsoft.AspNetCore.Rewrite.RuleResult> descritti nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="3c207-629">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| <span data-ttu-id="3c207-630">Riscrivi risultato contesto</span><span class="sxs-lookup"><span data-stu-id="3c207-630">Rewrite context result</span></span>               | <span data-ttu-id="3c207-631">Azione</span><span class="sxs-lookup"><span data-stu-id="3c207-631">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="3c207-632">`RuleResult.ContinueRules` (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="3c207-632">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="3c207-633">Continuare ad applicare le regole.</span><span class="sxs-lookup"><span data-stu-id="3c207-633">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="3c207-634">Interrompere l'applicazione delle regole e inviare la risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-634">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="3c207-635">Interrompere l'applicazione delle regole e inviare il contesto al middleware successivo.</span><span class="sxs-lookup"><span data-stu-id="3c207-635">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="3c207-636">L'app di esempio visualizza un metodo che reindirizza le richieste per i percorsi che terminano con *.xml*.</span><span class="sxs-lookup"><span data-stu-id="3c207-636">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="3c207-637">Se viene inviata una richiesta per `/file.xml`, la richiesta viene reindirizzata a `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="3c207-637">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="3c207-638">Il codice di stato viene impostato su *301 - Spostato permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="3c207-638">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="3c207-639">Quando il browser invia una nuova richiesta per */xmlfiles/file.xml*, il middleware dei file statici rende disponibile il file al client dalla cartella *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="3c207-639">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="3c207-640">Per un reindirizzamento, impostare in modo esplicito il codice di stato della risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-640">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="3c207-641">In caso contrario, viene restituito il codice di stato *200 - OK* e il reindirizzamento non viene eseguito nel client.</span><span class="sxs-lookup"><span data-stu-id="3c207-641">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="3c207-642">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="3c207-642">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="3c207-643">Questo approccio consente anche di riscrivere le richieste.</span><span class="sxs-lookup"><span data-stu-id="3c207-643">This approach can also rewrite requests.</span></span> <span data-ttu-id="3c207-644">L'app di esempio illustra la riscrittura del percorso di una richiesta di file di testo per rendere disponibile il file di testo *file. txt* dalla cartella *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="3c207-644">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="3c207-645">Il middleware dei file statici rende disponibile il file in base al percorso di richiesta aggiornato:</span><span class="sxs-lookup"><span data-stu-id="3c207-645">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="3c207-646">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="3c207-646">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="3c207-647">Regola basata su IRule</span><span class="sxs-lookup"><span data-stu-id="3c207-647">IRule-based rule</span></span>

<span data-ttu-id="3c207-648">Usare <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> per usare la logica della regola in una classe che implementa l'interfaccia <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="3c207-648">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="3c207-649">`IRule` garantisce maggiore flessibilità rispetto all'approccio con una regola basata su un metodo.</span><span class="sxs-lookup"><span data-stu-id="3c207-649">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="3c207-650">La classe di implementazione può includere un costruttore, che consente di passare parametri per il metodo <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="3c207-650">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="3c207-651">I valori dei parametri nell'app di esempio per `extension` e `newPath` vengono verificati e devono soddisfare diverse condizioni.</span><span class="sxs-lookup"><span data-stu-id="3c207-651">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="3c207-652">`extension` deve contenere un valore e tale valore deve essere *.png*, *.jpg* o *.gif*.</span><span class="sxs-lookup"><span data-stu-id="3c207-652">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="3c207-653">Se `newPath` non è valido, viene generato un evento <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="3c207-653">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="3c207-654">Se viene inviata una richiesta per *image.png*, la richiesta viene reindirizzata a `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="3c207-654">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="3c207-655">Se viene inviata una richiesta per *image.jpg*, la richiesta viene reindirizzata a `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="3c207-655">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="3c207-656">Il codice di stato viene impostato su *301 - Spostato permanentemente* e l'elemento `context.Result` viene impostato per l'interruzione dell'elaborazione delle regole e l'invio della risposta.</span><span class="sxs-lookup"><span data-stu-id="3c207-656">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="3c207-657">Richiesta originale: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="3c207-657">Original Request: `/image.png`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte per image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="3c207-659">Richiesta originale: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="3c207-659">Original Request: `/image.jpg`</span></span>

![Finestra del browser con gli strumenti di sviluppo per il rilevamento di richieste e risposte per image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="3c207-661">Esempi di espressioni regolari</span><span class="sxs-lookup"><span data-stu-id="3c207-661">Regex examples</span></span>

| <span data-ttu-id="3c207-662">Obiettivo</span><span class="sxs-lookup"><span data-stu-id="3c207-662">Goal</span></span> | <span data-ttu-id="3c207-663">Esempio di stringa espressione regolare</span><span class="sxs-lookup"><span data-stu-id="3c207-663">Regex String &</span></span><br><span data-ttu-id="3c207-664">e corrispondenza</span><span class="sxs-lookup"><span data-stu-id="3c207-664">Match Example</span></span> | <span data-ttu-id="3c207-665">Esempio di stringa di sostituzione</span><span class="sxs-lookup"><span data-stu-id="3c207-665">Replacement String &</span></span><br><span data-ttu-id="3c207-666">e output</span><span class="sxs-lookup"><span data-stu-id="3c207-666">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="3c207-667">Riscrivere il percorso nella stringa di query</span><span class="sxs-lookup"><span data-stu-id="3c207-667">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="3c207-668">Rimuovere la barra finale</span><span class="sxs-lookup"><span data-stu-id="3c207-668">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="3c207-669">Applicare la barra finale</span><span class="sxs-lookup"><span data-stu-id="3c207-669">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="3c207-670">Evitare la riscrittura di richieste specifiche</span><span class="sxs-lookup"><span data-stu-id="3c207-670">Avoid rewriting specific requests</span></span> | <span data-ttu-id="3c207-671">`^(.*)(?<!\.axd)$` o `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="3c207-671">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="3c207-672">Sì: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="3c207-672">Yes: `/resource.htm`</span></span><br><span data-ttu-id="3c207-673">No: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="3c207-673">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="3c207-674">Ridisporre i segmenti di URL</span><span class="sxs-lookup"><span data-stu-id="3c207-674">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="3c207-675">Sostituire un segmento di URL</span><span class="sxs-lookup"><span data-stu-id="3c207-675">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="3c207-676">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="3c207-676">Additional resources</span></span>

* <xref:fundamentals/startup>
* <xref:fundamentals/middleware/index>
* [<span data-ttu-id="3c207-677">Espressioni regolari in .NET</span><span class="sxs-lookup"><span data-stu-id="3c207-677">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="3c207-678">Linguaggio di espressioni regolari-riferimento rapido</span><span class="sxs-lookup"><span data-stu-id="3c207-678">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* [<span data-ttu-id="3c207-679">Modulo Apache mod_rewrite</span><span class="sxs-lookup"><span data-stu-id="3c207-679">Apache mod_rewrite</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* <span data-ttu-id="3c207-680">[Using Url Rewrite Module 2.0 (for IIS)](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) (Uso di URL Rewrite Module 2.0 per IIS)</span><span class="sxs-lookup"><span data-stu-id="3c207-680">[Using Url Rewrite Module 2.0 (for IIS)](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)</span></span>
* <span data-ttu-id="3c207-681">[URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference) (Guida di riferimento per la configurazione di URL Rewrite Module)</span><span class="sxs-lookup"><span data-stu-id="3c207-681">[URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)</span></span>
* [<span data-ttu-id="3c207-682">Forum di IIS URL Rewrite Module</span><span class="sxs-lookup"><span data-stu-id="3c207-682">IIS URL Rewrite Module Forum</span></span>](https://forums.iis.net/1152.aspx)
* <span data-ttu-id="3c207-683">[Keep a simple URL structure](https://support.google.com/webmasters/answer/76329?hl=en) (Mantenere una struttura URL semplice)</span><span class="sxs-lookup"><span data-stu-id="3c207-683">[Keep a simple URL structure](https://support.google.com/webmasters/answer/76329?hl=en)</span></span>
* <span data-ttu-id="3c207-684">[10 URL Rewriting Tips and Tricks](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/) (10 suggerimenti e consigli per la riscrittura URL)</span><span class="sxs-lookup"><span data-stu-id="3c207-684">[10 URL Rewriting Tips and Tricks](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)</span></span>
* <span data-ttu-id="3c207-685">[To slash or not to slash](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html) (Uso del carattere barra)</span><span class="sxs-lookup"><span data-stu-id="3c207-685">[To slash or not to slash](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)</span></span>
