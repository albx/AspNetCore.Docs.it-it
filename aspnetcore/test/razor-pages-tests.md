---
title: Gli unit test di Razor Pages in ASP.NET Core
author: guardrex
description: Informazioni su come creare unit test per App Razor Pages.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 07/07/2017
uid: test/razor-pages-tests
ms.openlocfilehash: f89b4fcb0065e725f70deec7859e373f9158b4bd
ms.sourcegitcommit: 91cc1f07ef178ab709ea42f8b3a10399c970496e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/08/2019
ms.locfileid: "67622784"
---
# <a name="razor-pages-unit-tests-in-aspnet-core"></a><span data-ttu-id="2fdfe-103">Gli unit test di Razor Pages in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2fdfe-103">Razor Pages unit tests in ASP.NET Core</span></span>

<span data-ttu-id="2fdfe-104">Di [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="2fdfe-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="2fdfe-105">ASP.NET Core supporta unit test di App Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-105">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="2fdfe-106">Test dei dati è necessario accedere layer (DAL) e modelli di pagina consentono di garantire:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-106">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="2fdfe-107">Parti di un'app Razor Pages funzionano in modo indipendente e insieme come un'unità durante la costruzione di app.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-107">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="2fdfe-108">Classi e metodi sono limitati gli ambiti di responsabilità.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-108">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="2fdfe-109">Esiste documentazione aggiuntiva su modalità di comportamento dell'app.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-109">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="2fdfe-110">Regressioni, che sono gli errori con gli aggiornamenti al codice, sono disponibili durante la distribuzione e compilazione automatizzata.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-110">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="2fdfe-111">In questo argomento si presuppone una conoscenza di base dell'App Razor Pages e gli unit test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-111">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="2fdfe-112">Se non si ha familiarità con le app Razor Pages o concetti di test, vedere gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-112">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* <xref:razor-pages/index>
* <xref:tutorials/razor-pages/razor-pages-start>
* [<span data-ttu-id="2fdfe-113">Unit test c# in .NET Core tramite test dotnet e xUnit</span><span class="sxs-lookup"><span data-stu-id="2fdfe-113">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="2fdfe-114">[Visualizzare o scaricare il codice di esempio](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([procedura per il download](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="2fdfe-114">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="2fdfe-115">Il progetto di esempio è costituito da due App:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-115">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="2fdfe-116">App</span><span class="sxs-lookup"><span data-stu-id="2fdfe-116">App</span></span>         | <span data-ttu-id="2fdfe-117">Cartella del progetto</span><span class="sxs-lookup"><span data-stu-id="2fdfe-117">Project folder</span></span>                     | <span data-ttu-id="2fdfe-118">Descrizione</span><span class="sxs-lookup"><span data-stu-id="2fdfe-118">Description</span></span> |
| ----------- | ---------------------------------- | ----------- |
| <span data-ttu-id="2fdfe-119">App messaggi</span><span class="sxs-lookup"><span data-stu-id="2fdfe-119">Message app</span></span> | <span data-ttu-id="2fdfe-120">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="2fdfe-120">*src/RazorPagesTestSample*</span></span>         | <span data-ttu-id="2fdfe-121">Consente all'utente di aggiungere un messaggio, eliminare un messaggio, eliminare tutti i messaggi e analizzare i messaggi (trovare il numero medio di parole per ogni messaggio).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-121">Allows a user to add a message, delete one message, delete all messages, and analyze messages (find the average number of words per message).</span></span> |
| <span data-ttu-id="2fdfe-122">Testare l'app</span><span class="sxs-lookup"><span data-stu-id="2fdfe-122">Test app</span></span>    | <span data-ttu-id="2fdfe-123">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="2fdfe-123">*tests/RazorPagesTestSample.Tests*</span></span> | <span data-ttu-id="2fdfe-124">Utilizzato per unit test DAL e modello di pagina di indice dell'app messaggi.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-124">Used to unit test the DAL and Index page model of the message app.</span></span> |

<span data-ttu-id="2fdfe-125">I test possono essere eseguiti usando le funzionalità di test predefinito di un ambiente IDE, ad esempio [Visual Studio](/visualstudio/test/unit-test-your-code) oppure [Visual Studio per Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-125">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](/visualstudio/test/unit-test-your-code) or [Visual Studio for Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span></span> <span data-ttu-id="2fdfe-126">Se si usa [Visual Studio Code](https://code.visualstudio.com/) o la riga di comando, eseguire il comando seguente al prompt dei comandi nel *tests/RazorPagesTestSample.Tests* cartella:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-126">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```console
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="2fdfe-127">Organizzazione delle app messaggi</span><span class="sxs-lookup"><span data-stu-id="2fdfe-127">Message app organization</span></span>

<span data-ttu-id="2fdfe-128">L'app di messaggio è un sistema di messaggi di Razor Pages con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-128">The message app is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="2fdfe-129">La pagina di indice dell'app (*cshtml* e *Pages/Index.cshtml.cs*) fornisce i metodi di modello per controllare l'aggiunta, eliminazione e l'analisi dei messaggi (trovare il numero medio di una pagina e dell'interfaccia utente parole per ogni messaggio).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-129">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (find the average number of words per message).</span></span>
* <span data-ttu-id="2fdfe-130">Un messaggio è descritta dal `Message` classe (*Data/Message.cs*) con due proprietà: `Id` (chiave) e `Text` (messaggio).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-130">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="2fdfe-131">Il `Text` proprietà è necessaria e limitata a 200 caratteri.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-131">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="2fdfe-132">I messaggi vengono archiviati usando [database in memoria di Entity Framework](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-132">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="2fdfe-133">L'app contiene un nella relativa classe di contesto di database, `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-133">The app contains a DAL in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="2fdfe-134">I metodi DAL sono contrassegnati come `virtual`, che consente i metodi per l'uso nei test di simulazione.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-134">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="2fdfe-135">Se il database è vuoto all'avvio dell'app, l'archivio di messaggi viene inizializzata con tre messaggi.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-135">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="2fdfe-136">Questi *seeding messaggi* vengono anche usati nei test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-136">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="2fdfe-137">&#8224;L'argomento relativo alla EF [Test con InMemory](/ef/core/miscellaneous/testing/in-memory), spiega come usare un database in memoria per i test con MSTest.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-137">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="2fdfe-138">Questo argomento viene utilizzato il [xUnit](https://xunit.github.io/) framework di test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-138">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="2fdfe-139">Concetti di test e test implementazioni su Framework di test diversi sono simili ma non identici.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-139">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="2fdfe-140">Anche se l'app di esempio non usa il modello di repository e non è un esempio efficace del [schema Unit of Work (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), pagine Razor supporta questi modelli di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-140">Although the sample app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="2fdfe-141">Per altre informazioni, vedere [la progettazione del livello di persistenza dell'infrastruttura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) e <xref:mvc/controllers/testing> (l'esempio implementa il modello di repository).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-141">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and <xref:mvc/controllers/testing> (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="2fdfe-142">Organizzazione dei test app</span><span class="sxs-lookup"><span data-stu-id="2fdfe-142">Test app organization</span></span>

<span data-ttu-id="2fdfe-143">L'app di test è un'app console all'interno di *tests/RazorPagesTestSample.Tests* cartella.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-143">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="2fdfe-144">Cartella di app di test</span><span class="sxs-lookup"><span data-stu-id="2fdfe-144">Test app folder</span></span> | <span data-ttu-id="2fdfe-145">Descrizione</span><span class="sxs-lookup"><span data-stu-id="2fdfe-145">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="2fdfe-146">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="2fdfe-146">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="2fdfe-147">*DataAccessLayerTest.cs* contiene gli unit test per DAL.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-147">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="2fdfe-148">*IndexPageTests.cs* contiene gli unit test per il modello di pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-148">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="2fdfe-149">*Utilità*</span><span class="sxs-lookup"><span data-stu-id="2fdfe-149">*Utilities*</span></span>     | <span data-ttu-id="2fdfe-150">Contiene il `TestDbContextOptions` metodo utilizzato per creare le opzioni di contesto per ogni unit test DAL nuovo database in modo che il database viene reimpostato alla sua condizione della linea di base per ogni test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-150">Contains the `TestDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="2fdfe-151">Il framework di test viene [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-151">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="2fdfe-152">L'oggetto framework di simulazione [Moq](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-152">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="2fdfe-153">Gli unit test dei dati di accesso layer (DAL)</span><span class="sxs-lookup"><span data-stu-id="2fdfe-153">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="2fdfe-154">L'app di messaggio ha DAL con quattro metodi contenuti nel `AppDbContext` classe (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-154">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="2fdfe-155">Ogni metodo presenta uno o due unit test nell'app di test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-155">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="2fdfe-156">Metodo DAL</span><span class="sxs-lookup"><span data-stu-id="2fdfe-156">DAL method</span></span>               | <span data-ttu-id="2fdfe-157">Funzione</span><span class="sxs-lookup"><span data-stu-id="2fdfe-157">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="2fdfe-158">Ottiene un `List<Message>` dal database vengono ordinato i `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-158">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="2fdfe-159">Aggiunge un `Message` al database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-159">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="2fdfe-160">Elimina tutti `Message` voci dal database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-160">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="2fdfe-161">Elimina una singola `Message` dal database tramite `Id`.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-161">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="2fdfe-162">Gli unit test del valore DAL richiedono <xref:Microsoft.EntityFrameworkCore.DbContextOptions> quando si crea un nuovo `AppDbContext` per ogni test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-162">Unit tests of the DAL require <xref:Microsoft.EntityFrameworkCore.DbContextOptions> when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="2fdfe-163">Un approccio alla creazione di `DbContextOptions` per ogni test consiste nell'usare un <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-163">One approach to creating the `DbContextOptions` for each test is to use a <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="2fdfe-164">Il problema con questo approccio è che ogni test riceve il database in qualsiasi stato lasciato il test precedente in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-164">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="2fdfe-165">Ciò può essere problematico quando si tenta di scrivere test unità atomica che non interferiscano tra loro.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-165">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="2fdfe-166">Per forzare il `AppDbContext` per usare un nuovo contesto di database per ogni test, fornire un `DbContextOptions` istanza basata su un nuovo provider del servizio.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-166">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="2fdfe-167">L'app di test viene illustrato come eseguire questa operazione usando il `Utilities` metodo della classe `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="2fdfe-167">The test app shows how to do this using its `Utilities` class method `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="2fdfe-168">Uso di `DbContextOptions` dell'unità DAL test consente a ogni test viene eseguito in modo atomico con un'istanza di database aggiornato:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-168">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="2fdfe-169">Ogni metodo di test nel `DataAccessLayerTest` classe (*UnitTests/DataAccessLayerTest.cs*) segue uno schema analogo Arrange-Act-Assert:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-169">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="2fdfe-170">Disponi: Il database è configurato per il test e/o il risultato previsto è definito.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-170">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="2fdfe-171">ACT: Viene eseguito il test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-171">Act: The test is executed.</span></span>
1. <span data-ttu-id="2fdfe-172">L'asserzione: Le asserzioni vengono effettuate per determinare se il risultato del test è un esito positivo.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-172">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="2fdfe-173">Ad esempio, il `DeleteMessageAsync` metodo è responsabile della rimozione di un singolo messaggio identificato dal relativo `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span><span class="sxs-lookup"><span data-stu-id="2fdfe-173">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="2fdfe-174">Esistono due test per questo metodo.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-174">There are two tests for this method.</span></span> <span data-ttu-id="2fdfe-175">Un test verifica che il metodo elimina un messaggio quando il messaggio è presente nel database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-175">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="2fdfe-176">Gli altri test di metodo che il database non cambia se il messaggio `Id` per l'eliminazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-176">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="2fdfe-177">Il `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` metodo è illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-177">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="2fdfe-178">In primo luogo, il metodo esegue il passaggio di disposizione, in cui avviene la preparazione per il passaggio di Act.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-178">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="2fdfe-179">I messaggi di seeding vengono ottenuti e conservati in `seedMessages`.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-179">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="2fdfe-180">I messaggi seeding vengono salvati nel database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-180">The seeding messages are saved into the database.</span></span> <span data-ttu-id="2fdfe-181">Il messaggio con un `Id` di `1` è impostato per l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-181">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="2fdfe-182">Quando la `DeleteMessageAsync` metodo viene eseguito, i messaggi previsti devono avere tutti i messaggi tranne quello con un `Id` di `1`.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-182">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="2fdfe-183">Il `expectedMessages` variabile rappresenta il risultato previsto.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-183">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="2fdfe-184">Il metodo opera: Il `DeleteMessageAsync` metodo viene eseguito passando il `recId` di `1`:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-184">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="2fdfe-185">Infine, il metodo ottiene il `Messages` dal contesto e confrontato con il `expectedMessages` che asserisce che i due sono uguali:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-185">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="2fdfe-186">Per poter confrontare che i due `List<Message>` sono gli stessi:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-186">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="2fdfe-187">I messaggi vengono ordinati in base `Id`.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-187">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="2fdfe-188">Coppie di messaggi vengono confrontate nel `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-188">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="2fdfe-189">Un metodo di test simile, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` controlla il risultato del tentativo di eliminare un messaggio che non esiste.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-189">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="2fdfe-190">In questo caso, i messaggi previsti nel database devono essere uguali per i messaggi effettivi dopo il `DeleteMessageAsync` metodo viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-190">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="2fdfe-191">Non vi sarà alcuna modifica al contenuto del database:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-191">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="2fdfe-192">Gli unit test dei metodi di modello di pagina</span><span class="sxs-lookup"><span data-stu-id="2fdfe-192">Unit tests of the page model methods</span></span>

<span data-ttu-id="2fdfe-193">Un altro set di unit test è responsabile per i test di metodi del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-193">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="2fdfe-194">Nell'app messaggi, i modelli di pagina di indice si trovano nel `IndexModel` classe *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-194">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="2fdfe-195">Metodo del modello di pagina</span><span class="sxs-lookup"><span data-stu-id="2fdfe-195">Page model method</span></span> | <span data-ttu-id="2fdfe-196">Funzione</span><span class="sxs-lookup"><span data-stu-id="2fdfe-196">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="2fdfe-197">Ottiene i messaggi per l'interfaccia utente utilizzando il `GetMessagesAsync` (metodo).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-197">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="2fdfe-198">Se il [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) valido, le chiamate `AddMessageAsync` per aggiungere un messaggio al database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-198">If the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="2fdfe-199">Le chiamate `DeleteAllMessagesAsync` per eliminare tutti i messaggi nel database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-199">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="2fdfe-200">Viene eseguito `DeleteMessageAsync` per eliminare un messaggio con il `Id` specificato.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-200">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="2fdfe-201">Se uno o più messaggi si trovano in database di, calcola il numero medio di parole al messaggio.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-201">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="2fdfe-202">I metodi del modello di pagina vengono testati utilizzando sette test nel `IndexPageTests` classe (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-202">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="2fdfe-203">I test utilizzano il familiare modello Arrange-Assert-Act.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-203">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="2fdfe-204">Questi test sono incentrati su:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-204">These tests focus on:</span></span>

* <span data-ttu-id="2fdfe-205">Determinare se i metodi seguono il comportamento corretto quando la [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) non è valido.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-205">Determining if the methods follow the correct behavior when the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is invalid.</span></span>
* <span data-ttu-id="2fdfe-206">Per confermare i metodi producono i valori corretti <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-206">Confirming the methods produce the correct <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span></span>
* <span data-ttu-id="2fdfe-207">Verifica che le assegnazioni dei valori di proprietà vengano eseguiti correttamente.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-207">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="2fdfe-208">Questo gruppo di test simulare spesso i metodi di per produrre dati previsto per il passaggio di Act in cui viene eseguito un metodo del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-208">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="2fdfe-209">Ad esempio, il `GetMessagesAsync` metodo del `AppDbContext` è fittizie per produrre un output.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-209">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="2fdfe-210">Quando questo metodo viene eseguito un metodo di modello di pagina, la simulazione restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-210">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="2fdfe-211">I dati non provengono dal database.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-211">The data doesn't come from the database.</span></span> <span data-ttu-id="2fdfe-212">Ciò consente di creare condizioni di test prevedibili e affidabili per l'utilizzo nei test del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-212">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="2fdfe-213">Il `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` testare viene mostrato come la `GetMessagesAsync` metodo è simulato per il modello di pagina:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-213">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="2fdfe-214">Quando la `OnGetAsync` metodo viene eseguito nel passaggio Act, chiama il modello di pagina `GetMessagesAsync` (metodo).</span><span class="sxs-lookup"><span data-stu-id="2fdfe-214">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="2fdfe-215">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span><span class="sxs-lookup"><span data-stu-id="2fdfe-215">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="2fdfe-216">`IndexPage` modello di pagina `OnGetAsync` metodo (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span><span class="sxs-lookup"><span data-stu-id="2fdfe-216">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="2fdfe-217">Il `GetMessagesAsync` DAL metodo non restituisce il risultato per questa chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-217">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="2fdfe-218">La versione fittizia del metodo restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-218">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="2fdfe-219">Nel `Assert` passaggio, i messaggi effettivi (`actualMessages`) vengono assegnati dal `Messages` proprietà del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-219">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="2fdfe-220">Un controllo del tipo viene eseguito anche quando sono assegnati i messaggi.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-220">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="2fdfe-221">I messaggi previsti ed effettivi vengono confrontati per loro `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-221">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="2fdfe-222">Il test asserisce che i due `List<Message>` istanze contengono gli stessi messaggi.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-222">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="2fdfe-223">Altri test in questo gruppo creano pagina oggetti modello che includono il <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, il <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, un <xref:Microsoft.AspNetCore.Mvc.ActionContext> per stabilire la `PageContext`, una `ViewDataDictionary`e un `PageContext`.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-223">Other tests in this group create page model objects that include the <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, an <xref:Microsoft.AspNetCore.Mvc.ActionContext> to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="2fdfe-224">Sono utili nell'esecuzione dei test.</span><span class="sxs-lookup"><span data-stu-id="2fdfe-224">These are useful in conducting tests.</span></span> <span data-ttu-id="2fdfe-225">Ad esempio, l'app messaggi stabilisce una `ModelState` errore con <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> per verificare che un valore valido <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> viene restituito quando `OnPostAddMessageAsync` viene eseguito:</span><span class="sxs-lookup"><span data-stu-id="2fdfe-225">For example, the message app establishes a `ModelState` error with <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> to check that a valid <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="2fdfe-226">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="2fdfe-226">Additional resources</span></span>

* [<span data-ttu-id="2fdfe-227">Unit test c# in .NET Core tramite test dotnet e xUnit</span><span class="sxs-lookup"><span data-stu-id="2fdfe-227">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:mvc/controllers/testing>
* <span data-ttu-id="2fdfe-228">[Unit Test del codice](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="2fdfe-228">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* <xref:test/integration-tests>
* [<span data-ttu-id="2fdfe-229">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="2fdfe-229">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="2fdfe-230">Creazione di una soluzione .NET Core completa in macOS con Visual Studio per Mac</span><span class="sxs-lookup"><span data-stu-id="2fdfe-230">Building a complete .NET Core solution on macOS using Visual Studio for Mac</span></span>](/dotnet/core/tutorials/using-on-mac-vs-full-solution)
* [<span data-ttu-id="2fdfe-231">Introduzione a xUnit.net: Uso di .NET Core con la riga di comando di .NET SDK</span><span class="sxs-lookup"><span data-stu-id="2fdfe-231">Getting started with xUnit.net: Using .NET Core with the .NET SDK command line</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="2fdfe-232">Moq</span><span class="sxs-lookup"><span data-stu-id="2fdfe-232">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="2fdfe-233">Guida introduttiva Moq</span><span class="sxs-lookup"><span data-stu-id="2fdfe-233">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)
